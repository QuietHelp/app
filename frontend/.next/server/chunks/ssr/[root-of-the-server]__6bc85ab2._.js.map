{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../lib/ws.ts","../../../../app/matching/page.tsx","../../../../app/matching/MatchingContent.tsx","../../../../components/Matching.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","'use client';\n\nimport { Client, type IFrame } from \"@stomp/stompjs\";\nimport SockJS from \"sockjs-client\";\n\nlet stompClient: Client | null = null;\nconst WS_URL = `${process.env.NEXT_PUBLIC_API_URL}/ws`;\n\nexport function getStompClient(): Client {\n  if (stompClient) return stompClient;\n\n  stompClient = new Client({\n    webSocketFactory: () => (new SockJS(WS_URL) as unknown as WebSocket),\n    reconnectDelay: 5000,\n    heartbeatIncoming: 4000,\n    heartbeatOutgoing: 4000,\n    onConnect: () => console.log(\"WebSocket connected\"),\n    onDisconnect: () => console.log(\"WebSocket disconnected\"),\n    onStompError: (frame: IFrame) => {\n      console.error(\"STOMP error:\", frame.headers[\"message\"], frame.body);\n    },\n  });\n\n  stompClient.activate();\n  return stompClient;\n}\n\nexport function waitForConnection(client: Client): Promise<void> {\n  return new Promise((resolve) => {\n    if (client.connected) return resolve();\n\n    const prevOnConnect = client.onConnect;\n    client.onConnect = (frame: IFrame) => {\n      if (prevOnConnect) prevOnConnect(frame);\n      resolve();\n      client.onConnect = prevOnConnect ?? (() => {});\n    };\n  });\n}\n\nexport async function disconnectStompClient(): Promise<void> {\n  if (!stompClient) return;\n  await stompClient.deactivate();\n  stompClient = null;\n}\n\n","'use client';\n\nimport { Suspense } from 'react';\nimport MatchingContent from './MatchingContent';\n\nexport default function MatchingPage() {\n  return (\n    <Suspense fallback={<div style={{ padding: '2rem', textAlign: 'center' }}>Loading...</div>}>\n      <MatchingContent />\n    </Suspense>\n  );\n}\n","'use client';\n\nimport { useEffect, useState, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Matching from '../../components/Matching';\n\ntype MatchFound = { roomId: string; peerSessionId: string };\n\nexport default function MatchingContent() {\n  const router = useRouter();\n  const [sessionId, setSessionId] = useState<string | null>(null);\n  const [formData, setFormData] = useState<{ mood: string; age: number; country: string } | null>(null);\n  const [mounted, setMounted] = useState(false);\n\n  // Load data from localStorage only on the client side\n  useEffect(() => {\n    setMounted(true);\n    \n    const storedSessionId = sessionStorage.getItem('sessionId');\n    setSessionId(storedSessionId);\n    \n    const savedFormData = sessionStorage.getItem('matchingData');\n    if (savedFormData) {\n      try {\n        setFormData(JSON.parse(savedFormData));\n      } catch {\n        setFormData(null);\n      }\n    } else {\n      setFormData(null);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!mounted) return;\n    \n    if (!sessionId) {\n      router.push('/');\n      return;\n    }\n    \n    if (!formData) {\n      router.push('/mood');\n      return;\n    }\n  }, [sessionId, formData, router, mounted]);\n\n  const handleMatchFound = useCallback((data: MatchFound) => {\n    // Store match data in localStorage for the chat page\n    sessionStorage.setItem('matchData', JSON.stringify(data));\n    router.push(`/chat/${data.roomId}`);\n  }, [router]);\n\n  // Show loading until mounted and data is loaded\n  if (!mounted || !sessionId || !formData) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center gradient-bg\">\n        <div className=\"text-white text-lg\">Loading...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full overflow-auto\">\n      <div className=\"min-h-screen flex flex-col p-4 sm:p-6 lg:p-8 gradient-bg\">\n        <main className=\"grow flex items-center justify-center\">\n        \n            <Matching\n              sessionId={sessionId}\n              mood={formData.mood}\n              age={formData.age}\n              country={formData.country}\n              onMatchFound={handleMatchFound}\n            />\n         </main>\n      </div>\n    </div>\n    \n  );\n}\n\n","'use client';\n\nimport { useEffect, useRef } from \"react\";\nimport type { IMessage, StompSubscription } from \"@stomp/stompjs\";\nimport { getStompClient, waitForConnection } from \"../lib/ws\";\n\ntype MatchFound = { roomId: string; peerSessionId: string };\n\ninterface MatchingProps {\n  sessionId: string;\n  mood: string;\n  age: number;\n  country: string;\n  onMatchFound: (data: MatchFound) => void;\n}\n\nexport default function Matching({ sessionId, mood, age, country, onMatchFound }: MatchingProps) {\n  const subscriptionRef = useRef<StompSubscription | null>(null);\n  const startedRef = useRef(false);\n  const onMatchFoundRef = useRef(onMatchFound);\n\n  // Keep callback ref updated\n  useEffect(() => {\n    onMatchFoundRef.current = onMatchFound;\n  }, [onMatchFound]);\n\n  useEffect(() => {\n    let isMounted = true;\n\n    const setupConnection = async () => {\n      try {\n        const client = getStompClient();\n        await waitForConnection(client);\n\n        if (!isMounted) return;\n\n        // Guard against React StrictMode double-effect in dev\n        if (startedRef.current) return;\n        startedRef.current = true;\n\n        subscriptionRef.current = client.subscribe(\n          `/topic/match/${sessionId}`,\n          (message: IMessage) => {\n            try {\n              const data = JSON.parse(message.body) as MatchFound;\n              onMatchFoundRef.current(data);\n            } catch (error) {\n              console.error(\"Failed to parse match message:\", error);\n            }\n          }\n        );\n\n        // Send match request with all form data\n        client.publish({\n          destination: \"/app/match.join\",\n          body: JSON.stringify({ sessionId, mood, age, country }),\n        });\n      } catch (error) {\n        console.error(\"Failed to setup WebSocket:\", error);\n      }\n    };\n\n    setupConnection();\n\n    return () => {\n      isMounted = false;\n      startedRef.current = false;\n\n      if (subscriptionRef.current) {\n        subscriptionRef.current.unsubscribe();\n        subscriptionRef.current = null;\n      }\n    };\n  }, [sessionId, mood, age, country]);\n\n  return (\n    <div \n      className=\"text-center\"\n    >\n      <h2 \n        className=\"h1 text-white mb-4 sm:mb-6\"\n      >\n        Looking for someone...\n      </h2>\n      <p \n        className=\"text-lg sm:text-xl text-white/90\"\n      >\n        We&apos;re finding someone who understands.\n      </p>\n      <div \n        className=\"mt-8 flex justify-center\"\n      >\n        <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-4 border-white/30 border-t-white\"></div>\n      </div>\n      <footer \n        className=\"mt-8 text-white/70 text-sm\"\n      >\n      </footer>\n    </div>\n  );\n}\n\n"],"names":["module","exports","require","vendored","AppRouterContext","HooksClientContext","ServerInsertedHtml","process","env","NEXT_RUNTIME","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2,3,4,5]}