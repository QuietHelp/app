module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},78135,70106,a=>{"use strict";var b=a.i(72131);let c=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)},d=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let f=(0,b.forwardRef)(({color:a="currentColor",size:c=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,b.createElement)("svg",{ref:l,...e,width:c,height:c,stroke:a,strokeWidth:g?24*Number(f)/Number(c):f,className:d("lucide",h),...!i&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0})(k)&&{"aria-hidden":"true"},...k},[...j.map(([a,c])=>(0,b.createElement)(a,c)),...Array.isArray(i)?i:[i]])),g=(a,e)=>{let g=(0,b.forwardRef)(({className:g,...h},i)=>(0,b.createElement)(f,{ref:i,iconNode:e,className:d(`lucide-${c(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,g),...h}));return g.displayName=c(a),g};a.s(["default",()=>g],70106);let h=g("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);a.s(["GlobeIcon",()=>h],78135)},14658,a=>{"use strict";function b(a){let b=Date.now(),c="string"==typeof a?new Date(a).getTime():a,d=Math.floor((b-c)/1e3),e=Math.floor(d/60),f=Math.floor(e/60),g=Math.floor(f/24);if(d<10)return"Just now";if(d<60)return`${d}s ago`;if(e<60)return`${e}m ago`;if(f<24)return`${f}h ago`;if(g<7)return`${g}d ago`;let h=new Date(c),i=new Date,j=new Date(i);return(j.setDate(j.getDate()-1),h.toDateString()===i.toDateString())?h.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):h.toDateString()===j.toDateString()?`Yesterday ${h.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`:h.toLocaleDateString("en-US",{month:"short",day:"numeric",year:h.getFullYear()!==i.getFullYear()?"numeric":void 0})}function c(a){return new Date("string"==typeof a?new Date(a).getTime():a).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function d(a,b){if(!b)return!0;let c=new Date("string"==typeof a.timestamp?new Date(a.timestamp).getTime():a.timestamp),d=new Date("string"==typeof b.timestamp?new Date(b.timestamp).getTime():b.timestamp);return c.getDate()!==d.getDate()||c.getMonth()!==d.getMonth()||c.getFullYear()!==d.getFullYear()}function e(a){let b=new Date("string"==typeof a?new Date(a).getTime():a),c=new Date,d=new Date(c);return(d.setDate(d.getDate()-1),b.toDateString()===c.toDateString())?"Today":b.toDateString()===d.toDateString()?"Yesterday":b.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:b.getFullYear()!==c.getFullYear()?"numeric":void 0})}a.s(["formatDateSeparator",()=>e,"formatFullTimestamp",()=>c,"formatMessageTime",()=>b,"shouldShowDateSeparator",()=>d])},38330,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(6001),e=a.i(65936),f=a.i(14658),g=a.i(78135);let h=process.env.NEXT_PUBLIC_WS_URL||"http://localhost:8080/ws";function i({sessionId:a}){let[i,j]=(0,c.useState)([]),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),q=(0,c.useRef)(null),r=(0,c.useRef)(a),s=(0,c.useRef)(null),t=(0,c.useRef)(null),u=(0,c.useRef)("");(0,c.useEffect)(()=>{let a=localStorage.getItem("chat_username_broadcast");if(!a){let b=Date.now().toString().slice(-6),c=Math.floor(1e3*Math.random());a=`Guest${b}${c}`,localStorage.setItem("chat_username_broadcast",a)}u.current=a},[]);let v=(0,c.useCallback)(async()=>{try{let a=await fetch("http://localhost:8080/api/chat/history");if(!a.ok)throw Error("Failed to load chat history");let b=await a.json();b.messages&&Array.isArray(b.messages)&&j(b.messages)}catch(a){console.error("Error loading chat history:",a)}},[]),w=(0,c.useCallback)(()=>{try{q.current&&q.current.deactivate();let a=new d.Client({webSocketFactory:()=>new e.default(h),reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3,onConnect:()=>{n(!0),p(null),s.current=a.subscribe("/topic/chat",a=>{try{let b=JSON.parse(a.body);b&&"string"==typeof b.username&&"string"==typeof b.message&&j(a=>[...a,b])}catch(a){console.error("Error parsing message:",a)}})},onDisconnect:()=>{n(!1),s.current=null},onStompError:a=>{console.error("STOMP error:",a.headers.message,a.body),p("Connection error. Reconnecting...")},onWebSocketError:a=>{console.error("WebSocket error:",a),p("Connection error. Reconnecting...")}});q.current=a,a.activate()}catch(a){console.error("Error connecting to WebSocket:",a),p("Failed to connect. Retrying..."),t.current=setTimeout(()=>{w()},5e3)}},[]);(0,c.useEffect)(()=>{r.current=a},[a]),(0,c.useEffect)(()=>(v(),w(),()=>{t.current&&clearTimeout(t.current),s.current&&s.current.unsubscribe(),q.current&&q.current.deactivate()}),[w,v]);let x=(0,c.useCallback)(()=>{q.current&&q.current.connected||w()},[w]),y=(0,c.useCallback)(async()=>{let b=k.trim();if(b&&q.current&&q.current.connected)try{let c=await fetch("/api/moderate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:b})}),d=await c.json();if(!d.isAppropriate){p(`Message cannot be sent: ${d.reason||"Content violates community guidelines"}`),setTimeout(()=>p(null),5e3);return}let e={message:b,username:u.current,senderSessionId:a};q.current.publish({destination:"/app/chat.send",body:JSON.stringify(e)}),l(""),p(null)}catch(a){console.error("Error sending message:",a),p("Failed to send message. Please try again.")}},[k,a]);return(0,b.jsxs)("div",{className:"h-[calc(100vh-4rem)] flex flex-col",children:[(0,b.jsxs)("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"h4 text-white mb-1 flex items-center gap-2",children:["Global Chat ",(0,b.jsx)(g.GlobeIcon,{className:"w-4 h-4 text-blue-600"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:`w-2 h-2 rounded-full ${m?"bg-green-400 animate-pulse":"bg-yellow-400"}`}),(0,b.jsx)("p",{className:"text-sm text-white/80",children:m?"Connected":"Connecting..."})]})]}),!m&&(0,b.jsx)("button",{onClick:x,className:"text-xs text-blue-300 hover:text-blue-200 underline px-2 py-1",children:"Reconnect"})]}),o&&(0,b.jsx)("p",{className:"text-xs text-red-300 mt-2",children:o})]}),(0,b.jsx)("div",{className:"flex-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 overflow-y-auto mb-4 min-h-0",children:0===i.length?(0,b.jsx)("div",{className:"text-center text-white/60 mt-8",children:(0,b.jsx)("h3",{className:"h3 text-white mb-1",children:"Start the conversation!"})}):(0,b.jsx)("div",{className:"space-y-3",children:i.map((a,c)=>{let d=a.senderSessionId===r.current,e="string"==typeof a.timestamp?new Date(a.timestamp).getTime():a.timestamp,g=(0,f.shouldShowDateSeparator)(a,i[c-1]);return(0,b.jsxs)("div",{children:[g&&(0,b.jsx)("div",{className:"flex justify-center my-4",children:(0,b.jsx)("span",{className:"text-xs text-white/50 bg-white/10 px-3 py-1 rounded-full",children:(0,f.formatDateSeparator)(e)})}),(0,b.jsx)("div",{className:`flex ${d?"justify-end":"justify-start"} mb-1`,children:(0,b.jsxs)("div",{className:`max-w-[75%] sm:max-w-[65%] ${d?"bg-blue-600 text-white rounded-2xl rounded-tr-sm":"bg-white/20 text-white rounded-2xl rounded-tl-sm"} px-4 py-2.5 shadow-sm`,title:(0,f.formatFullTimestamp)(e),children:[(0,b.jsx)("div",{className:"text-xs font-medium mb-1 opacity-90",children:a.username||"Guest"}),(0,b.jsx)("div",{className:"text-sm sm:text-base wrap-break-word leading-relaxed",children:a.message}),(0,b.jsx)("div",{className:`text-[10px] opacity-70 mt-1.5 flex ${d?"justify-end":"justify-start"}`,children:(0,f.formatMessageTime)(e)})]})})]},c)})})}),(0,b.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,b.jsx)("div",{className:"flex-1 relative",children:(0,b.jsx)("textarea",{value:k,onChange:a=>l(a.target.value),placeholder:"Type a message...",rows:1,className:"w-full p-3 sm:p-4 text-base bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 focus:bg-white/20 resize-none min-h-[48px] max-h-32 overflow-y-auto scrollbar-hide disabled:opacity-50",onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),y())},disabled:!m,style:{height:"auto"},onInput:a=>{let b=a.target;b.style.height="auto",b.style.height=`${Math.min(b.scrollHeight,128)}px`}})}),(0,b.jsx)("button",{onClick:y,disabled:!m||!k.trim(),className:"px-5 sm:px-6 py-3 sm:py-4 bg-white text-blue-600 rounded-2xl font-medium hover:bg-white/90 active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-white/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white flex items-center justify-center min-w-[64px]",children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:(0,b.jsx)("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})})})]})]})}function j(){let[a,d]=(0,c.useState)(null),[e,f]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{f(!0);let a=sessionStorage.getItem("sessionId");if(!a){let b=crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;sessionStorage.setItem("sessionId",b),a=b}d(a)},[]),e&&a)?(0,b.jsx)("div",{className:"h-full overflow-auto",children:(0,b.jsx)("div",{className:"min-h-screen flex flex-col p-4 sm:p-6 lg:p-8 gradient-bg",children:(0,b.jsx)("main",{className:"grow flex items-center justify-center",children:(0,b.jsx)("div",{className:"max-w-4xl mx-auto w-full",children:(0,b.jsx)(i,{sessionId:a})})})})}):(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center gradient-bg",children:(0,b.jsx)("div",{className:"text-white text-lg",children:"Loading..."})})}a.s(["default",()=>j],38330)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__4ec818d1._.js.map