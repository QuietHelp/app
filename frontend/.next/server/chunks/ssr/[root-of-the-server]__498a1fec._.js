module.exports=[9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},82524,a=>{"use strict";var b=a.i(6001),c=a.i(65936);let d=null;function e(){return d||(d=new b.Client({webSocketFactory:()=>new c.default("http://localhost:8080/ws"),reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3,onConnect:()=>console.log("WebSocket connected"),onDisconnect:()=>console.log("WebSocket disconnected"),onStompError:a=>{console.error("STOMP error:",a.headers.message,a.body)}})).activate(),d}function f(a){return new Promise(b=>{if(a.connected)return b();let c=a.onConnect;a.onConnect=d=>{c&&c(d),b(),a.onConnect=c??(()=>{})}})}a.s(["getStompClient",()=>e,"waitForConnection",()=>f])},14658,a=>{"use strict";function b(a){let b=Date.now(),c="string"==typeof a?new Date(a).getTime():a,d=Math.floor((b-c)/1e3),e=Math.floor(d/60),f=Math.floor(e/60),g=Math.floor(f/24);if(d<10)return"Just now";if(d<60)return`${d}s ago`;if(e<60)return`${e}m ago`;if(f<24)return`${f}h ago`;if(g<7)return`${g}d ago`;let h=new Date(c),i=new Date,j=new Date(i);return(j.setDate(j.getDate()-1),h.toDateString()===i.toDateString())?h.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):h.toDateString()===j.toDateString()?`Yesterday ${h.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`:h.toLocaleDateString("en-US",{month:"short",day:"numeric",year:h.getFullYear()!==i.getFullYear()?"numeric":void 0})}function c(a){return new Date("string"==typeof a?new Date(a).getTime():a).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function d(a,b){if(!b)return!0;let c=new Date("string"==typeof a.timestamp?new Date(a.timestamp).getTime():a.timestamp),d=new Date("string"==typeof b.timestamp?new Date(b.timestamp).getTime():b.timestamp);return c.getDate()!==d.getDate()||c.getMonth()!==d.getMonth()||c.getFullYear()!==d.getFullYear()}function e(a){let b=new Date("string"==typeof a?new Date(a).getTime():a),c=new Date,d=new Date(c);return(d.setDate(d.getDate()-1),b.toDateString()===c.toDateString())?"Today":b.toDateString()===d.toDateString()?"Yesterday":b.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:b.getFullYear()!==c.getFullYear()?"numeric":void 0})}a.s(["formatDateSeparator",()=>e,"formatFullTimestamp",()=>c,"formatMessageTime",()=>b,"shouldShowDateSeparator",()=>d])},52460,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(82524),f=a.i(14658);function g({sessionId:a,matchData:d}){let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(""),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(""),o=(0,c.useRef)(null),p=(0,c.useRef)(!1),q=(0,c.useRef)(a),r=async a=>{try{let b=(0,e.getStompClient)();if(await (0,e.waitForConnection)(b),!a||p.current)return;p.current=!0,o.current=b.subscribe(`/topic/chat/${d.roomId}`,a=>(a=>{try{let b=JSON.parse(a);if(b&&"string"==typeof b.message){b.senderSessionId&&b.senderSessionId!==q.current&&b.username&&n(b.username);let a={...b,roomId:d.roomId,senderSessionId:b.senderSessionId||q.current,timestamp:b.timestamp||Date.now()};h(b=>[...b,a])}}catch(a){console.error("Failed to parse chat message:",a)}})(a.body))}catch(a){console.error("Failed to setup chat connection:",a)}};(0,c.useEffect)(()=>{let b=sessionStorage.getItem(`chat_username_${a}`);if(b)l(b);else{let b=a.replace(/-/g,""),c=String((parseInt(b.substring(0,6),16)^parseInt(b.substring(8,14),16)^parseInt(b.substring(16,22),16))%0x5f5e0ff+1).padStart(8,"0"),d=`Friend${c}`;sessionStorage.setItem(`chat_username_${a}`,d),l(d)}},[a]),(0,c.useEffect)(()=>{q.current=a},[a]),(0,c.useEffect)(()=>(r(!0),()=>{p.current=!1,o.current&&(o.current.unsubscribe(),o.current=null)}),[d.roomId]);let s=async()=>{let b=i.trim();if(b)try{let c=await fetch("/api/moderate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:b})}),f=await c.json();if(!f.isAppropriate)return void alert(`Message cannot be sent: ${f.reason||"Content violates community guidelines"}`);let g=(0,e.getStompClient)();await (0,e.waitForConnection)(g);let h={roomId:d.roomId,senderSessionId:a,message:b,username:k};g.publish({destination:"/app/chat.send",body:JSON.stringify(h)}),j("")}catch(a){console.error("Failed to send message:",a),alert("Failed to send message. Please try again.")}};return(0,b.jsxs)("div",{className:"h-[calc(100vh-4rem)] flex flex-col",children:[(0,b.jsx)("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 mb-4",children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"h4 text-white mb-1",children:"Chat Room"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,b.jsx)("p",{className:"text-sm text-white/80",children:m?`Connected to ${m}`:"Connected"})]})]})})}),(0,b.jsx)("div",{className:"flex-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 overflow-y-auto mb-4 min-h-0",children:0===g.length?(0,b.jsx)("div",{className:"text-center text-white/60 mt-8",children:(0,b.jsx)("h3",{className:"h3 text-white mb-1",children:"Start the conversation!"})}):(0,b.jsx)("div",{className:"space-y-3",children:g.map((a,c)=>{let d=a.senderSessionId===q.current,e="string"==typeof a.timestamp?new Date(a.timestamp).getTime():a.timestamp,h=(0,f.shouldShowDateSeparator)(a,g[c-1]);return(0,b.jsxs)("div",{children:[h&&(0,b.jsx)("div",{className:"flex justify-center my-4",children:(0,b.jsx)("span",{className:"text-xs text-white/50 bg-white/10 px-3 py-1 rounded-full",children:(0,f.formatDateSeparator)(e)})}),(0,b.jsx)("div",{className:`flex ${d?"justify-end":"justify-start"} mb-1`,children:(0,b.jsxs)("div",{className:`max-w-[75%] sm:max-w-[65%] ${d?"bg-blue-600 text-white rounded-2xl rounded-tr-sm":"bg-white/20 text-white rounded-2xl rounded-tl-sm"} px-4 py-2.5 shadow-sm`,title:(0,f.formatFullTimestamp)(e),children:[(0,b.jsx)("div",{className:"text-sm sm:text-base wrap-break-word leading-relaxed",children:a.message}),(0,b.jsx)("div",{className:`text-[10px] opacity-70 mt-1.5 flex ${d?"justify-end":"justify-start"}`,children:(0,f.formatMessageTime)(e)})]})})]},c)})})}),(0,b.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,b.jsx)("div",{className:"flex-1 relative",children:(0,b.jsx)("textarea",{value:i,onChange:a=>j(a.target.value),placeholder:"Type a message...",rows:1,className:"w-full p-3 sm:p-4 text-base bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 focus:bg-white/20 resize-none min-h-[48px] max-h-32 overflow-y-auto scrollbar-hide",onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),s())},style:{height:"auto"},onInput:a=>{let b=a.target;b.style.height="auto",b.style.height=`${Math.min(b.scrollHeight,128)}px`}})}),(0,b.jsx)("button",{onClick:s,disabled:!i.trim(),className:"px-5 sm:px-6 py-3 sm:py-4 bg-white height-8 text-blue-600 rounded-2xl font-medium hover:bg-white/90 active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-white/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white flex items-center justify-center min-w-[64px]",children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-9",children:(0,b.jsx)("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})})})]})]})}function h(){let a=(0,d.useParams)(),e=(0,d.useRouter)(),f=a.roomId,[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{m(!0);let a=sessionStorage.getItem("sessionId"),b=sessionStorage.getItem("matchData");if(i(a),b)try{let a=JSON.parse(b);a.roomId===f?k(a):k(null)}catch{k(null)}else k(null)},[f]),(0,c.useEffect)(()=>{if(l){if(!h)return void e.push("/");if(!f||!j)return void e.push("/matching")}},[h,f,j,e,l]),l&&h&&j)?(0,b.jsx)("div",{className:"min-h-screen gradient-bg",children:(0,b.jsx)("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8",children:(0,b.jsx)(g,{sessionId:h,matchData:j})})}):(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center gradient-bg",children:(0,b.jsx)("div",{className:"text-white text-lg",children:"Loading..."})})}a.s(["default",()=>h],52460)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__498a1fec._.js.map