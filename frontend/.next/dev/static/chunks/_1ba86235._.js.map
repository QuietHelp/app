{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/lib/ws.ts"],"sourcesContent":["'use client';\n\nimport { Client, type IFrame } from \"@stomp/stompjs\";\nimport SockJS from \"sockjs-client\";\n\nlet stompClient: Client | null = null;\nconst WS_URL = `${process.env.NEXT_PUBLIC_API_URL}/ws`;\n\nexport function getStompClient(): Client {\n  if (stompClient) return stompClient;\n\n  stompClient = new Client({\n    webSocketFactory: () => (new SockJS(WS_URL) as unknown as WebSocket),\n    reconnectDelay: 5000,\n    heartbeatIncoming: 4000,\n    heartbeatOutgoing: 4000,\n    onConnect: () => console.log(\"WebSocket connected\"),\n    onDisconnect: () => console.log(\"WebSocket disconnected\"),\n    onStompError: (frame: IFrame) => {\n      console.error(\"STOMP error:\", frame.headers[\"message\"], frame.body);\n    },\n  });\n\n  stompClient.activate();\n  return stompClient;\n}\n\nexport function waitForConnection(client: Client): Promise<void> {\n  return new Promise((resolve) => {\n    if (client.connected) return resolve();\n\n    const prevOnConnect = client.onConnect;\n    client.onConnect = (frame: IFrame) => {\n      if (prevOnConnect) prevOnConnect(frame);\n      resolve();\n      client.onConnect = prevOnConnect ?? (() => {});\n    };\n  });\n}\n\nexport async function disconnectStompClient(): Promise<void> {\n  if (!stompClient) return;\n  await stompClient.deactivate();\n  stompClient = null;\n}\n\n"],"names":[],"mappings":";;;;;;;;AAMkB;AAJlB;AACA;AAHA;;;AAKA,IAAI,cAA6B;AACjC,MAAM,SAAS,6DAAmC,GAAG,CAAC;AAE/C,SAAS;IACd,IAAI,aAAa,OAAO;IAExB,cAAc,IAAI,iKAAM,CAAC;QACvB,kBAAkB,IAAO,IAAI,8JAAM,CAAC;QACpC,gBAAgB;QAChB,mBAAmB;QACnB,mBAAmB;QACnB,WAAW,IAAM,QAAQ,GAAG,CAAC;QAC7B,cAAc,IAAM,QAAQ,GAAG,CAAC;QAChC,cAAc,CAAC;YACb,QAAQ,KAAK,CAAC,gBAAgB,MAAM,OAAO,CAAC,UAAU,EAAE,MAAM,IAAI;QACpE;IACF;IAEA,YAAY,QAAQ;IACpB,OAAO;AACT;AAEO,SAAS,kBAAkB,MAAc;IAC9C,OAAO,IAAI,QAAQ,CAAC;QAClB,IAAI,OAAO,SAAS,EAAE,OAAO;QAE7B,MAAM,gBAAgB,OAAO,SAAS;QACtC,OAAO,SAAS,GAAG,CAAC;YAClB,IAAI,eAAe,cAAc;YACjC;YACA,OAAO,SAAS,GAAG,iBAAiB,CAAC,KAAO,CAAC;QAC/C;IACF;AACF;AAEO,eAAe;IACpB,IAAI,CAAC,aAAa;IAClB,MAAM,YAAY,UAAU;IAC5B,cAAc;AAChB"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/lib/chatUtils.ts"],"sourcesContent":["/**\n * Utility functions for chat features\n * Inspired by WhatsApp, Messenger, Instagram, and Omegle\n */\n\n/**\n * Formats timestamp to relative time (e.g., \"Just now\", \"2 min ago\", \"1 hour ago\")\n * Similar to WhatsApp and Messenger\n */\nexport function formatMessageTime(timestamp: number | string): string {\n  const now = Date.now();\n  const messageTime = typeof timestamp === 'string' ? new Date(timestamp).getTime() : timestamp;\n  const diffMs = now - messageTime;\n  const diffSecs = Math.floor(diffMs / 1000);\n  const diffMins = Math.floor(diffSecs / 60);\n  const diffHours = Math.floor(diffMins / 60);\n  const diffDays = Math.floor(diffHours / 24);\n\n  if (diffSecs < 10) return 'Just now';\n  if (diffSecs < 60) return `${diffSecs}s ago`;\n  if (diffMins < 60) return `${diffMins}m ago`;\n  if (diffHours < 24) return `${diffHours}h ago`;\n  if (diffDays < 7) return `${diffDays}d ago`;\n\n  // For older messages, show date and time\n  const date = new Date(messageTime);\n  const today = new Date();\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n\n  if (date.toDateString() === today.toDateString()) {\n    return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });\n  } else if (date.toDateString() === yesterday.toDateString()) {\n    return `Yesterday ${date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`;\n  } else {\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: date.getFullYear() !== today.getFullYear() ? 'numeric' : undefined });\n  }\n}\n\n/**\n * Formats timestamp to full date and time for tooltips\n */\nexport function formatFullTimestamp(timestamp: number | string): string {\n  const messageTime = typeof timestamp === 'string' ? new Date(timestamp).getTime() : timestamp;\n  const date = new Date(messageTime);\n  return date.toLocaleString('en-US', {\n    month: 'short',\n    day: 'numeric',\n    year: 'numeric',\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: true,\n  });\n}\n\n/**\n * Groups messages by date for better organization\n * Useful for showing date separators like WhatsApp\n */\nexport function shouldShowDateSeparator(\n  currentMessage: { timestamp: number | string },\n  previousMessage?: { timestamp: number | string }\n): boolean {\n  if (!previousMessage) return true;\n\n  const currentDate = new Date(\n    typeof currentMessage.timestamp === 'string'\n      ? new Date(currentMessage.timestamp).getTime()\n      : currentMessage.timestamp\n  );\n  const previousDate = new Date(\n    typeof previousMessage.timestamp === 'string'\n      ? new Date(previousMessage.timestamp).getTime()\n      : previousMessage.timestamp\n  );\n\n  return (\n    currentDate.getDate() !== previousDate.getDate() ||\n    currentDate.getMonth() !== previousDate.getMonth() ||\n    currentDate.getFullYear() !== previousDate.getFullYear()\n  );\n}\n\n/**\n * Formats date separator (e.g., \"Today\", \"Yesterday\", \"December 25, 2024\")\n */\nexport function formatDateSeparator(timestamp: number | string): string {\n  const date = new Date(typeof timestamp === 'string' ? new Date(timestamp).getTime() : timestamp);\n  const today = new Date();\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n\n  if (date.toDateString() === today.toDateString()) {\n    return 'Today';\n  } else if (date.toDateString() === yesterday.toDateString()) {\n    return 'Yesterday';\n  } else {\n    return date.toLocaleDateString('en-US', {\n      weekday: 'long',\n      month: 'long',\n      day: 'numeric',\n      year: date.getFullYear() !== today.getFullYear() ? 'numeric' : undefined,\n    });\n  }\n}\n\n\n"],"names":[],"mappings":"AAAA;;;CAGC,GAED;;;CAGC;;;;;;;;;;AACM,SAAS,kBAAkB,SAA0B;IAC1D,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,cAAc,OAAO,cAAc,WAAW,IAAI,KAAK,WAAW,OAAO,KAAK;IACpF,MAAM,SAAS,MAAM;IACrB,MAAM,WAAW,KAAK,KAAK,CAAC,SAAS;IACrC,MAAM,WAAW,KAAK,KAAK,CAAC,WAAW;IACvC,MAAM,YAAY,KAAK,KAAK,CAAC,WAAW;IACxC,MAAM,WAAW,KAAK,KAAK,CAAC,YAAY;IAExC,IAAI,WAAW,IAAI,OAAO;IAC1B,IAAI,WAAW,IAAI,OAAO,GAAG,SAAS,KAAK,CAAC;IAC5C,IAAI,WAAW,IAAI,OAAO,GAAG,SAAS,KAAK,CAAC;IAC5C,IAAI,YAAY,IAAI,OAAO,GAAG,UAAU,KAAK,CAAC;IAC9C,IAAI,WAAW,GAAG,OAAO,GAAG,SAAS,KAAK,CAAC;IAE3C,yCAAyC;IACzC,MAAM,OAAO,IAAI,KAAK;IACtB,MAAM,QAAQ,IAAI;IAClB,MAAM,YAAY,IAAI,KAAK;IAC3B,UAAU,OAAO,CAAC,UAAU,OAAO,KAAK;IAExC,IAAI,KAAK,YAAY,OAAO,MAAM,YAAY,IAAI;QAChD,OAAO,KAAK,kBAAkB,CAAC,SAAS;YAAE,MAAM;YAAW,QAAQ;YAAW,QAAQ;QAAK;IAC7F,OAAO,IAAI,KAAK,YAAY,OAAO,UAAU,YAAY,IAAI;QAC3D,OAAO,CAAC,UAAU,EAAE,KAAK,kBAAkB,CAAC,SAAS;YAAE,MAAM;YAAW,QAAQ;YAAW,QAAQ;QAAK,IAAI;IAC9G,OAAO;QACL,OAAO,KAAK,kBAAkB,CAAC,SAAS;YAAE,OAAO;YAAS,KAAK;YAAW,MAAM,KAAK,WAAW,OAAO,MAAM,WAAW,KAAK,YAAY;QAAU;IACrJ;AACF;AAKO,SAAS,oBAAoB,SAA0B;IAC5D,MAAM,cAAc,OAAO,cAAc,WAAW,IAAI,KAAK,WAAW,OAAO,KAAK;IACpF,MAAM,OAAO,IAAI,KAAK;IACtB,OAAO,KAAK,cAAc,CAAC,SAAS;QAClC,OAAO;QACP,KAAK;QACL,MAAM;QACN,MAAM;QACN,QAAQ;QACR,QAAQ;IACV;AACF;AAMO,SAAS,wBACd,cAA8C,EAC9C,eAAgD;IAEhD,IAAI,CAAC,iBAAiB,OAAO;IAE7B,MAAM,cAAc,IAAI,KACtB,OAAO,eAAe,SAAS,KAAK,WAChC,IAAI,KAAK,eAAe,SAAS,EAAE,OAAO,KAC1C,eAAe,SAAS;IAE9B,MAAM,eAAe,IAAI,KACvB,OAAO,gBAAgB,SAAS,KAAK,WACjC,IAAI,KAAK,gBAAgB,SAAS,EAAE,OAAO,KAC3C,gBAAgB,SAAS;IAG/B,OACE,YAAY,OAAO,OAAO,aAAa,OAAO,MAC9C,YAAY,QAAQ,OAAO,aAAa,QAAQ,MAChD,YAAY,WAAW,OAAO,aAAa,WAAW;AAE1D;AAKO,SAAS,oBAAoB,SAA0B;IAC5D,MAAM,OAAO,IAAI,KAAK,OAAO,cAAc,WAAW,IAAI,KAAK,WAAW,OAAO,KAAK;IACtF,MAAM,QAAQ,IAAI;IAClB,MAAM,YAAY,IAAI,KAAK;IAC3B,UAAU,OAAO,CAAC,UAAU,OAAO,KAAK;IAExC,IAAI,KAAK,YAAY,OAAO,MAAM,YAAY,IAAI;QAChD,OAAO;IACT,OAAO,IAAI,KAAK,YAAY,OAAO,UAAU,YAAY,IAAI;QAC3D,OAAO;IACT,OAAO;QACL,OAAO,KAAK,kBAAkB,CAAC,SAAS;YACtC,SAAS;YACT,OAAO;YACP,KAAK;YACL,MAAM,KAAK,WAAW,OAAO,MAAM,WAAW,KAAK,YAAY;QACjE;IACF;AACF"}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/components/ChatRoom.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport type { IMessage, StompSubscription } from \"@stomp/stompjs\";\nimport { getStompClient, waitForConnection } from \"@/lib/ws\";\nimport { formatMessageTime, formatFullTimestamp, shouldShowDateSeparator, formatDateSeparator } from \"../lib/chatUtils\";\n\nexport type ChatMessage = {\n  roomId?: string;\n  senderSessionId?: string;\n  message: string;\n  timestamp: number | string; // Epoch milliseconds (number) or ISO string\n  username?: string; // Optional, from backend\n};\n\nexport type MatchFound = {\n  roomId: string;\n  peerSessionId: string;\n};\n\nexport type ChatRoomProps = {\n  sessionId: string;\n  matchData: MatchFound;\n};\n\nexport default function ChatRoom({ sessionId, matchData }: ChatRoomProps) {\n  const router = useRouter();\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [input, setInput] = useState(\"\");\n  const [myUsername, setMyUsername] = useState<string>(\"\");\n  const [peerUsername, setPeerUsername] = useState<string>(\"\");\n  const [isLeaving, setIsLeaving] = useState(false);\n\n  const subscriptionRef = useRef<StompSubscription | null>(null);\n  const didSubscribeRef = useRef(false);\n  const sessionIdRef = useRef<string>(sessionId);\n  const historyLoadedRef = useRef(false);\n\n   // Handler function for processing messages\n   const handleMessage = (messageBody: string) => {\n    try {\n      const data = JSON.parse(messageBody) as ChatMessage;\n      \n      // Validate message structure\n      if (data && typeof data.message === 'string') {\n        // Track peer's username from their messages\n        if (data.senderSessionId && data.senderSessionId !== sessionIdRef.current) {\n          if (data.username) {\n            setPeerUsername(data.username);\n          }\n        }\n        \n        // Ensure roomId and senderSessionId are set for room-based chat\n        const roomMessage: ChatMessage = {\n          ...data,\n          roomId: matchData.roomId,\n          senderSessionId: data.senderSessionId || sessionIdRef.current,\n          timestamp: data.timestamp || Date.now(),\n        };\n        \n        setMessages((prev) => [...prev, roomMessage]);\n      }\n    } catch (error) {\n      console.error(\"Failed to parse chat message:\", error);\n    }\n  };\n\n  const setupConnection = async (isMounted: boolean) => {\n    try {\n      const client = getStompClient();\n      await waitForConnection(client);\n\n      if (!isMounted) return;\n\n      // React StrictMode can run effects twice in dev; guard to avoid double subscribe\n      if (didSubscribeRef.current) return;\n      didSubscribeRef.current = true;\n\n      // Subscribe to room-specific topic\n      subscriptionRef.current = client.subscribe(\n        `/topic/chat/${matchData.roomId}`,\n        (message: IMessage) => handleMessage(message.body)\n      );\n    } catch (error) {\n      console.error(\"Failed to setup chat connection:\", error);\n    }\n  };\n  \n  // Generate or retrieve username for current user\n  useEffect(() => {\n    const storedUsername = sessionStorage.getItem(`chat_username_${sessionId}`);\n    if (storedUsername) {\n      setMyUsername(storedUsername);\n    } else {\n      // Generate a unique guest username using sessionId (UUID) to ensure uniqueness\n      // Each UUID is unique, so we use multiple parts of it to create a unique numeric identifier\n      const uuidHex = sessionId.replace(/-/g, '');\n      // Use parts from different sections of the UUID and combine them\n      const part1 = parseInt(uuidHex.substring(0, 6), 16);\n      const part2 = parseInt(uuidHex.substring(8, 14), 16);\n      const part3 = parseInt(uuidHex.substring(16, 22), 16);\n      // Combine all parts using XOR to distribute values better\n      const combined = (part1 ^ part2 ^ part3) % 99999999;\n      const usernameSuffix = String(combined + 1).padStart(8, '0'); // +1 to avoid 00000000\n      const username = `Friend${usernameSuffix}`;\n      sessionStorage.setItem(`chat_username_${sessionId}`, username);\n      setMyUsername(username);\n    }\n  }, [sessionId]);\n\n  // Keep sessionId ref updated\n  useEffect(() => {\n    sessionIdRef.current = sessionId;\n  }, [sessionId]);\n\n  // Load room chat history on mount\n  useEffect(() => {\n    const loadRoomHistory = async () => {\n      if (historyLoadedRef.current || !matchData.roomId) return;\n      \n      try {\n        const backendUrl = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080';\n        const response = await fetch(`${backendUrl}/api/chat/history/${matchData.roomId}`);\n        \n        if (response.ok) {\n          const data = await response.json();\n          if (data.messages && Array.isArray(data.messages)) {\n            // Set messages and mark as loaded\n            setMessages(data.messages);\n            historyLoadedRef.current = true;\n          }\n        }\n      } catch (err) {\n        console.error('Error loading room chat history:', err);\n        // Don't show error to user - just continue without history\n      }\n    };\n\n    loadRoomHistory();\n  }, [matchData.roomId]);\n\n  useEffect(() => {\n    let isMounted = true;\n    setupConnection(isMounted);\n\n    return () => {\n      isMounted = false;\n      didSubscribeRef.current = false;\n\n      if (subscriptionRef.current) {\n        subscriptionRef.current.unsubscribe();\n        subscriptionRef.current = null;\n      }\n    };\n  }, [matchData.roomId]);\n\n  const sendMessage = async () => {\n    const messageText = input.trim();\n    if (!messageText) return;\n\n    try {\n      // Moderate message before sending\n      const moderationResponse = await fetch('/api/moderate', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ message: messageText }),\n      });\n\n      const moderationResult = await moderationResponse.json();\n\n      if (!moderationResult.isAppropriate) {\n        alert(`Message cannot be sent: ${moderationResult.reason || 'Content violates community guidelines'}`);\n        return;\n      }\n\n      const client = getStompClient();\n      await waitForConnection(client);\n\n      const chatMessage = {\n        roomId: matchData.roomId,\n        senderSessionId: sessionId,\n        message: messageText,\n        username: myUsername, // Send our username so backend can use it\n      };\n\n      client.publish({\n        destination: \"/app/chat.send\",\n        body: JSON.stringify(chatMessage),\n      });\n\n      setInput(\"\");\n    } catch (error) {\n      console.error(\"Failed to send message:\", error);\n      alert(\"Failed to send message. Please try again.\");\n    }\n  };\n\n  const handleNext = async () => {\n    if (isLeaving) return; // Prevent double-clicks\n    \n    setIsLeaving(true);\n    \n    try {\n      // Unsubscribe from current room\n      if (subscriptionRef.current) {\n        subscriptionRef.current.unsubscribe();\n        subscriptionRef.current = null;\n      }\n      \n      // Reset subscription flag so we can subscribe again\n      didSubscribeRef.current = false;\n      \n      // Clear match data from sessionStorage\n      sessionStorage.removeItem('matchData');\n      \n      // Navigate back to matching page\n      // The matching page will automatically re-join the queue with the same form data\n      router.push('/matching');\n    } catch (error) {\n      console.error(\"Error leaving room:\", error);\n      setIsLeaving(false);\n      alert(\"Failed to leave room. Please try again.\");\n    }\n  };\n\n  return (\n    <div className=\"h-[calc(100vh-4rem)] flex flex-col\">\n      <div className=\"bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 mb-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"h4 text-white mb-1\">Chat Room</h2>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse\"></div>\n              <p className=\"text-sm text-white/80\">\n                {peerUsername \n                  ? `Connected to ${peerUsername}`\n                  : \"Connected\"}\n              </p>\n            </div>\n          </div>\n          <button\n            onClick={handleNext}\n            disabled={isLeaving}\n            className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n            title=\"Find another person to talk to\"\n          >\n            {isLeaving ? (\n              <>\n                <svg className=\"animate-spin h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                </svg>\n                <span>Leaving...</span>\n              </>\n            ) : (\n              <>\n                <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\" className=\"w-4 h-4\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3\" />\n                </svg>\n                <span>Next</span>\n              </>\n            )}\n          </button>\n        </div>\n      </div>\n\n      <div className=\"flex-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 overflow-y-auto mb-4 min-h-0\">\n        {messages.length === 0 ? (\n          <div className=\"text-center text-white/60 mt-8\">\n            <h3 className=\"h3 text-white mb-1\">Start the conversation!</h3>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {messages.map((m, idx) => {\n              const isMyMessage = m.senderSessionId === sessionIdRef.current;\n              const timestamp = typeof m.timestamp === 'string' ? new Date(m.timestamp).getTime() : m.timestamp;\n              const showDateSeparator = shouldShowDateSeparator(m, messages[idx - 1]);\n              \n              return (\n                <div key={idx}>\n                  {showDateSeparator && (\n                    <div className=\"flex justify-center my-4\">\n                      <span className=\"text-xs text-white/50 bg-white/10 px-3 py-1 rounded-full\">\n                        {formatDateSeparator(timestamp)}\n                      </span>\n                    </div>\n                  )}\n                  <div className={`flex ${isMyMessage ? 'justify-end' : 'justify-start'} mb-1`}\n                  >\n                    <div \n                      className={`max-w-[75%] sm:max-w-[65%] ${\n                        isMyMessage \n                          ? 'bg-blue-600 text-white rounded-2xl rounded-tr-sm' \n                          : 'bg-white/20 text-white rounded-2xl rounded-tl-sm'\n                      } px-4 py-2.5 shadow-sm`}\n                      title={formatFullTimestamp(timestamp)}\n                    >\n                      <div className=\"text-sm sm:text-base wrap-break-word leading-relaxed\">\n                        {m.message}\n                      </div>\n                      <div className={`text-[10px] opacity-70 mt-1.5 flex ${isMyMessage ? 'justify-end' : 'justify-start'}`}>\n                        {formatMessageTime(timestamp)}\n                      </div>\n                    </div>\n                    </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      <div className=\"flex gap-2 items-end\">\n        <div className=\"flex-1 relative\">\n          <textarea\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            placeholder=\"Type a message...\"\n            rows={1}\n            className=\"w-full p-3 sm:p-4 text-base bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 focus:bg-white/20 resize-none min-h-[48px] max-h-32 overflow-y-auto scrollbar-hide\"\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\" && !e.shiftKey) {\n                e.preventDefault();\n                sendMessage();\n              }\n            }}\n            style={{\n              height: 'auto',\n            }}\n            onInput={(e) => {\n              const target = e.target as HTMLTextAreaElement;\n              target.style.height = 'auto';\n              target.style.height = `${Math.min(target.scrollHeight, 128)}px`;\n            }}\n          />\n        </div>\n        <button \n          onClick={sendMessage}\n          disabled={!input.trim()}\n          className=\"px-5 sm:px-6 py-3 sm:py-4 bg-white height-8 text-blue-600 rounded-2xl font-medium hover:bg-white/90 active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-white/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white flex items-center justify-center min-w-[64px]\"\n        >\n          <svg \n            xmlns=\"http://www.w3.org/2000/svg\" \n            viewBox=\"0 0 20 20\" \n            fill=\"currentColor\" \n            className=\"w-5 h-9\"\n          >\n            <path d=\"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z\" />\n          </svg>\n        </button>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 687, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/app/chat/%5BroomId%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport ChatRoom from '@/components/ChatRoom';\n\nexport default function ChatRoomPage() {\n  const params = useParams();\n  const router = useRouter();\n  const roomId = params.roomId as string;\n  \n  const [sessionId, setSessionId] = useState<string | null>(null);\n  const [matchData, setMatchData] = useState<{ roomId: string; peerSessionId: string } | null>(null);\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    // Mark as mounted to indicate we're on the client\n    setMounted(true);\n    \n    // Only access sessionStorage on the client side (sessionStorage is per-tab, localStorage is shared)\n    const storedSessionId = sessionStorage.getItem('sessionId');\n    const savedMatchData = sessionStorage.getItem('matchData');\n    \n    setSessionId(storedSessionId);\n    \n    if (savedMatchData) {\n      try {\n        const parsed = JSON.parse(savedMatchData);\n        // Verify the roomId matches\n        if (parsed.roomId === roomId) {\n          setMatchData(parsed);\n        } else {\n          setMatchData(null);\n        }\n      } catch {\n        setMatchData(null);\n      }\n    } else {\n      setMatchData(null);\n    }\n  }, [roomId]);\n\n  useEffect(() => {\n    if (!mounted) return;\n    \n    if (!sessionId) {\n      router.push('/');\n      return;\n    }\n\n    if (!roomId) {\n      router.push('/matching');\n      return;\n    }\n\n    if (!matchData) {\n      router.push('/matching');\n      return;\n    }\n  }, [sessionId, roomId, matchData, router, mounted]);\n\n  // Always show loading until mounted and data is loaded\n  if (!mounted || !sessionId || !matchData) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center gradient-bg\">\n        <div className=\"text-white text-lg\">Loading...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen gradient-bg\">\n      <div className=\"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8\">\n        <ChatRoom sessionId={sessionId} matchData={matchData} />\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAMe,SAAS;;IACtB,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,SAAS,OAAO,MAAM;IAE5B,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAgB;IAC1D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAmD;IAC7F,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,IAAA,0KAAS;kCAAC;YACR,kDAAkD;YAClD,WAAW;YAEX,oGAAoG;YACpG,MAAM,kBAAkB,eAAe,OAAO,CAAC;YAC/C,MAAM,iBAAiB,eAAe,OAAO,CAAC;YAE9C,aAAa;YAEb,IAAI,gBAAgB;gBAClB,IAAI;oBACF,MAAM,SAAS,KAAK,KAAK,CAAC;oBAC1B,4BAA4B;oBAC5B,IAAI,OAAO,MAAM,KAAK,QAAQ;wBAC5B,aAAa;oBACf,OAAO;wBACL,aAAa;oBACf;gBACF,EAAE,OAAM;oBACN,aAAa;gBACf;YACF,OAAO;gBACL,aAAa;YACf;QACF;iCAAG;QAAC;KAAO;IAEX,IAAA,0KAAS;kCAAC;YACR,IAAI,CAAC,SAAS;YAEd,IAAI,CAAC,WAAW;gBACd,OAAO,IAAI,CAAC;gBACZ;YACF;YAEA,IAAI,CAAC,QAAQ;gBACX,OAAO,IAAI,CAAC;gBACZ;YACF;YAEA,IAAI,CAAC,WAAW;gBACd,OAAO,IAAI,CAAC;gBACZ;YACF;QACF;iCAAG;QAAC;QAAW;QAAQ;QAAW;QAAQ;KAAQ;IAElD,uDAAuD;IACvD,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,WAAW;QACxC,qBACE,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC;gBAAI,WAAU;0BAAqB;;;;;;;;;;;IAG1C;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;sBACb,cAAA,6LAAC,qIAAQ;gBAAC,WAAW;gBAAW,WAAW;;;;;;;;;;;;;;;;AAInD;GAvEwB;;QACP,kJAAS;QACT,kJAAS;;;KAFF"}}]
}