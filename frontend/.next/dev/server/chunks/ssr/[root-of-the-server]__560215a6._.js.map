{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/lib/ws.ts"],"sourcesContent":["'use client';\n\nimport { Client, type IFrame } from \"@stomp/stompjs\";\nimport SockJS from \"sockjs-client\";\n\nlet stompClient: Client | null = null;\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080';\nconst WS_URL = `${API_BASE.replace(/\\/$/, '')}/ws`;\n\nexport function getStompClient(): Client {\n  if (stompClient) return stompClient;\n\n  stompClient = new Client({\n    webSocketFactory: () => (new SockJS(WS_URL) as unknown as WebSocket),\n    reconnectDelay: 5000,\n    heartbeatIncoming: 4000,\n    heartbeatOutgoing: 4000,\n    onConnect: () => console.log(\"WebSocket connected\"),\n    onDisconnect: () => console.log(\"WebSocket disconnected\"),\n    onStompError: (frame: IFrame) => {\n      console.error(\"STOMP error:\", frame.headers[\"message\"], frame.body);\n    },\n  });\n\n  stompClient.activate();\n  return stompClient;\n}\n\nexport function waitForConnection(client: Client): Promise<void> {\n  return new Promise((resolve) => {\n    if (client.connected) return resolve();\n\n    const prevOnConnect = client.onConnect;\n    client.onConnect = (frame: IFrame) => {\n      if (prevOnConnect) prevOnConnect(frame);\n      resolve();\n      client.onConnect = prevOnConnect ?? (() => {});\n    };\n  });\n}\n\nexport async function disconnectStompClient(): Promise<void> {\n  if (!stompClient) return;\n  await stompClient.deactivate();\n  stompClient = null;\n}\n\n"],"names":[],"mappings":";;;;;;;;AAEA;AACA;AAHA;;;AAKA,IAAI,cAA6B;AACjC,MAAM,WAAW,6DAAmC;AACpD,MAAM,SAAS,GAAG,SAAS,OAAO,CAAC,OAAO,IAAI,GAAG,CAAC;AAE3C,SAAS;IACd,IAAI,aAAa,OAAO;IAExB,cAAc,IAAI,8JAAM,CAAC;QACvB,kBAAkB,IAAO,IAAI,2JAAM,CAAC;QACpC,gBAAgB;QAChB,mBAAmB;QACnB,mBAAmB;QACnB,WAAW,IAAM,QAAQ,GAAG,CAAC;QAC7B,cAAc,IAAM,QAAQ,GAAG,CAAC;QAChC,cAAc,CAAC;YACb,QAAQ,KAAK,CAAC,gBAAgB,MAAM,OAAO,CAAC,UAAU,EAAE,MAAM,IAAI;QACpE;IACF;IAEA,YAAY,QAAQ;IACpB,OAAO;AACT;AAEO,SAAS,kBAAkB,MAAc;IAC9C,OAAO,IAAI,QAAQ,CAAC;QAClB,IAAI,OAAO,SAAS,EAAE,OAAO;QAE7B,MAAM,gBAAgB,OAAO,SAAS;QACtC,OAAO,SAAS,GAAG,CAAC;YAClB,IAAI,eAAe,cAAc;YACjC;YACA,OAAO,SAAS,GAAG,iBAAiB,CAAC,KAAO,CAAC;QAC/C;IACF;AACF;AAEO,eAAe;IACpB,IAAI,CAAC,aAAa;IAClB,MAAM,YAAY,UAAU;IAC5B,cAAc;AAChB"}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/components/Matching.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from \"react\";\nimport type { IMessage, StompSubscription } from \"@stomp/stompjs\";\nimport { getStompClient, waitForConnection } from \"../lib/ws\";\n\ntype MatchFound = { roomId: string; peerSessionId: string };\n\ninterface MatchingProps {\n  sessionId: string;\n  mood: string;\n  age: number;\n  country: string;\n  onMatchFound: (data: MatchFound) => void;\n}\n\nexport default function Matching({ sessionId, mood, age, country, onMatchFound }: MatchingProps) {\n  const subscriptionRef = useRef<StompSubscription | null>(null);\n  const startedRef = useRef(false);\n  const onMatchFoundRef = useRef(onMatchFound);\n\n  // Keep callback ref updated\n  useEffect(() => {\n    onMatchFoundRef.current = onMatchFound;\n  }, [onMatchFound]);\n\n  useEffect(() => {\n    let isMounted = true;\n\n    const setupConnection = async () => {\n      try {\n        const client = getStompClient();\n        await waitForConnection(client);\n\n        if (!isMounted) return;\n\n        // Guard against React StrictMode double-effect in dev\n        if (startedRef.current) return;\n        startedRef.current = true;\n\n        subscriptionRef.current = client.subscribe(\n          `/topic/match/${sessionId}`,\n          (message: IMessage) => {\n            try {\n              const data = JSON.parse(message.body) as MatchFound;\n              onMatchFoundRef.current(data);\n            } catch (error) {\n              console.error(\"Failed to parse match message:\", error);\n            }\n          }\n        );\n\n        // Send match request with all form data\n        client.publish({\n          destination: \"/app/match.join\",\n          body: JSON.stringify({ sessionId, mood, age, country }),\n        });\n      } catch (error) {\n        console.error(\"Failed to setup WebSocket:\", error);\n      }\n    };\n\n    setupConnection();\n\n    return () => {\n      isMounted = false;\n      startedRef.current = false;\n\n      if (subscriptionRef.current) {\n        subscriptionRef.current.unsubscribe();\n        subscriptionRef.current = null;\n      }\n    };\n  }, [sessionId, mood, age, country]);\n\n  return (\n    <div \n      className=\"text-center\"\n    >\n      <h2 \n        className=\"h1 text-white mb-4 sm:mb-6\"\n      >\n        Looking for someone...\n      </h2>\n      <p \n        className=\"text-lg sm:text-xl text-white/90\"\n      >\n        We&apos;re finding someone who understands.\n      </p>\n      <div \n        className=\"mt-8 flex justify-center\"\n      >\n        <div className=\"inline-block animate-spin rounded-full h-8 w-8 border-4 border-white/30 border-t-white\"></div>\n      </div>\n      <footer \n        className=\"mt-8 text-white/70 text-sm\"\n      >\n      </footer>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AAJA;;;;AAgBe,SAAS,SAAS,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,YAAY,EAAiB;IAC7F,MAAM,kBAAkB,IAAA,+MAAM,EAA2B;IACzD,MAAM,aAAa,IAAA,+MAAM,EAAC;IAC1B,MAAM,kBAAkB,IAAA,+MAAM,EAAC;IAE/B,4BAA4B;IAC5B,IAAA,kNAAS,EAAC;QACR,gBAAgB,OAAO,GAAG;IAC5B,GAAG;QAAC;KAAa;IAEjB,IAAA,kNAAS,EAAC;QACR,IAAI,YAAY;QAEhB,MAAM,kBAAkB;YACtB,IAAI;gBACF,MAAM,SAAS,IAAA,2HAAc;gBAC7B,MAAM,IAAA,8HAAiB,EAAC;gBAExB,IAAI,CAAC,WAAW;gBAEhB,sDAAsD;gBACtD,IAAI,WAAW,OAAO,EAAE;gBACxB,WAAW,OAAO,GAAG;gBAErB,gBAAgB,OAAO,GAAG,OAAO,SAAS,CACxC,CAAC,aAAa,EAAE,WAAW,EAC3B,CAAC;oBACC,IAAI;wBACF,MAAM,OAAO,KAAK,KAAK,CAAC,QAAQ,IAAI;wBACpC,gBAAgB,OAAO,CAAC;oBAC1B,EAAE,OAAO,OAAO;wBACd,QAAQ,KAAK,CAAC,kCAAkC;oBAClD;gBACF;gBAGF,wCAAwC;gBACxC,OAAO,OAAO,CAAC;oBACb,aAAa;oBACb,MAAM,KAAK,SAAS,CAAC;wBAAE;wBAAW;wBAAM;wBAAK;oBAAQ;gBACvD;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,8BAA8B;YAC9C;QACF;QAEA;QAEA,OAAO;YACL,YAAY;YACZ,WAAW,OAAO,GAAG;YAErB,IAAI,gBAAgB,OAAO,EAAE;gBAC3B,gBAAgB,OAAO,CAAC,WAAW;gBACnC,gBAAgB,OAAO,GAAG;YAC5B;QACF;IACF,GAAG;QAAC;QAAW;QAAM;QAAK;KAAQ;IAElC,qBACE,8OAAC;QACC,WAAU;;0BAEV,8OAAC;gBACC,WAAU;0BACX;;;;;;0BAGD,8OAAC;gBACC,WAAU;0BACX;;;;;;0BAGD,8OAAC;gBACC,WAAU;0BAEV,cAAA,8OAAC;oBAAI,WAAU;;;;;;;;;;;0BAEjB,8OAAC;gBACC,WAAU;;;;;;;;;;;;AAKlB"}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/app/matching/MatchingContent.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Matching from '../../components/Matching';\n\ntype MatchFound = { roomId: string; peerSessionId: string };\n\nexport default function MatchingContent() {\n  const router = useRouter();\n  const [sessionId, setSessionId] = useState<string | null>(null);\n  const [formData, setFormData] = useState<{ mood: string; age: number; country: string } | null>(null);\n  const [mounted, setMounted] = useState(false);\n\n  // Load data from localStorage only on the client side\n  useEffect(() => {\n    setMounted(true);\n    \n    const storedSessionId = sessionStorage.getItem('sessionId');\n    setSessionId(storedSessionId);\n    \n    const savedFormData = sessionStorage.getItem('matchingData');\n    if (savedFormData) {\n      try {\n        setFormData(JSON.parse(savedFormData));\n      } catch {\n        setFormData(null);\n      }\n    } else {\n      setFormData(null);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!mounted) return;\n    \n    if (!sessionId) {\n      router.push('/');\n      return;\n    }\n    \n    if (!formData) {\n      router.push('/mood');\n      return;\n    }\n  }, [sessionId, formData, router, mounted]);\n\n  const handleMatchFound = useCallback((data: MatchFound) => {\n    // Store match data in localStorage for the chat page\n    sessionStorage.setItem('matchData', JSON.stringify(data));\n    router.push(`/chat/${data.roomId}`);\n  }, [router]);\n\n  // Show loading until mounted and data is loaded\n  if (!mounted || !sessionId || !formData) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center gradient-bg\">\n        <div className=\"text-white text-lg\">Loading...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full overflow-auto\">\n      <div className=\"min-h-screen flex flex-col p-4 sm:p-6 lg:p-8 gradient-bg\">\n        <main className=\"grow flex items-center justify-center\">\n        \n            <Matching\n              sessionId={sessionId}\n              mood={formData.mood}\n              age={formData.age}\n              country={formData.country}\n              onMatchFound={handleMatchFound}\n            />\n         </main>\n      </div>\n    </div>\n    \n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAQe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAgB;IAC1D,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAwD;IAChG,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,sDAAsD;IACtD,IAAA,kNAAS,EAAC;QACR,WAAW;QAEX,MAAM,kBAAkB,eAAe,OAAO,CAAC;QAC/C,aAAa;QAEb,MAAM,gBAAgB,eAAe,OAAO,CAAC;QAC7C,IAAI,eAAe;YACjB,IAAI;gBACF,YAAY,KAAK,KAAK,CAAC;YACzB,EAAE,OAAM;gBACN,YAAY;YACd;QACF,OAAO;YACL,YAAY;QACd;IACF,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,SAAS;QAEd,IAAI,CAAC,WAAW;YACd,OAAO,IAAI,CAAC;YACZ;QACF;QAEA,IAAI,CAAC,UAAU;YACb,OAAO,IAAI,CAAC;YACZ;QACF;IACF,GAAG;QAAC;QAAW;QAAU;QAAQ;KAAQ;IAEzC,MAAM,mBAAmB,IAAA,oNAAW,EAAC,CAAC;QACpC,qDAAqD;QACrD,eAAe,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;QACnD,OAAO,IAAI,CAAC,CAAC,MAAM,EAAE,KAAK,MAAM,EAAE;IACpC,GAAG;QAAC;KAAO;IAEX,gDAAgD;IAChD,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,UAAU;QACvC,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAqB;;;;;;;;;;;IAG1C;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAK,WAAU;0BAEZ,cAAA,8OAAC,kIAAQ;oBACP,WAAW;oBACX,MAAM,SAAS,IAAI;oBACnB,KAAK,SAAS,GAAG;oBACjB,SAAS,SAAS,OAAO;oBACzB,cAAc;;;;;;;;;;;;;;;;;;;;;AAO5B"}},
    {"offset": {"line": 383, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/app/matching/page.tsx"],"sourcesContent":["'use client';\n\nimport { Suspense } from 'react';\nimport MatchingContent from './MatchingContent';\n\nexport default function MatchingPage() {\n  return (\n    <Suspense fallback={<div style={{ padding: '2rem', textAlign: 'center' }}>Loading...</div>}>\n      <MatchingContent />\n    </Suspense>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAKe,SAAS;IACtB,qBACE,8OAAC,iNAAQ;QAAC,wBAAU,8OAAC;YAAI,OAAO;gBAAE,SAAS;gBAAQ,WAAW;YAAS;sBAAG;;;;;;kBACxE,cAAA,8OAAC,8IAAe;;;;;;;;;;AAGtB"}}]
}