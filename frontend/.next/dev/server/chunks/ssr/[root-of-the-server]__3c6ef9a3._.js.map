{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/lib/ws.ts"],"sourcesContent":["'use client';\n\nimport { Client, type IFrame } from \"@stomp/stompjs\";\nimport SockJS from \"sockjs-client\";\n\nlet stompClient: Client | null = null;\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080';\nconst WS_URL = `${API_BASE.replace(/\\/$/, '')}/ws`;\n\nexport function getStompClient(): Client {\n  if (stompClient) return stompClient;\n\n  stompClient = new Client({\n    webSocketFactory: () => (new SockJS(WS_URL) as unknown as WebSocket),\n    reconnectDelay: 5000,\n    heartbeatIncoming: 4000,\n    heartbeatOutgoing: 4000,\n    onConnect: () => console.log(\"WebSocket connected\"),\n    onDisconnect: () => console.log(\"WebSocket disconnected\"),\n    onStompError: (frame: IFrame) => {\n      console.error(\"STOMP error:\", frame.headers[\"message\"], frame.body);\n    },\n  });\n\n  stompClient.activate();\n  return stompClient;\n}\n\nexport function waitForConnection(client: Client): Promise<void> {\n  return new Promise((resolve) => {\n    if (client.connected) return resolve();\n\n    const prevOnConnect = client.onConnect;\n    client.onConnect = (frame: IFrame) => {\n      if (prevOnConnect) prevOnConnect(frame);\n      resolve();\n      client.onConnect = prevOnConnect ?? (() => {});\n    };\n  });\n}\n\nexport async function disconnectStompClient(): Promise<void> {\n  if (!stompClient) return;\n  await stompClient.deactivate();\n  stompClient = null;\n}\n\n"],"names":[],"mappings":";;;;;;;;AAEA;AACA;AAHA;;;AAKA,IAAI,cAA6B;AACjC,MAAM,WAAW,6DAAmC;AACpD,MAAM,SAAS,GAAG,SAAS,OAAO,CAAC,OAAO,IAAI,GAAG,CAAC;AAE3C,SAAS;IACd,IAAI,aAAa,OAAO;IAExB,cAAc,IAAI,8JAAM,CAAC;QACvB,kBAAkB,IAAO,IAAI,2JAAM,CAAC;QACpC,gBAAgB;QAChB,mBAAmB;QACnB,mBAAmB;QACnB,WAAW,IAAM,QAAQ,GAAG,CAAC;QAC7B,cAAc,IAAM,QAAQ,GAAG,CAAC;QAChC,cAAc,CAAC;YACb,QAAQ,KAAK,CAAC,gBAAgB,MAAM,OAAO,CAAC,UAAU,EAAE,MAAM,IAAI;QACpE;IACF;IAEA,YAAY,QAAQ;IACpB,OAAO;AACT;AAEO,SAAS,kBAAkB,MAAc;IAC9C,OAAO,IAAI,QAAQ,CAAC;QAClB,IAAI,OAAO,SAAS,EAAE,OAAO;QAE7B,MAAM,gBAAgB,OAAO,SAAS;QACtC,OAAO,SAAS,GAAG,CAAC;YAClB,IAAI,eAAe,cAAc;YACjC;YACA,OAAO,SAAS,GAAG,iBAAiB,CAAC,KAAO,CAAC;QAC/C;IACF;AACF;AAEO,eAAe;IACpB,IAAI,CAAC,aAAa;IAClB,MAAM,YAAY,UAAU;IAC5B,cAAc;AAChB"}},
    {"offset": {"line": 152, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/lib/chatUtils.ts"],"sourcesContent":["/**\n * Utility functions for chat features\n * Inspired by WhatsApp, Messenger, Instagram, and Omegle\n */\n\n/**\n * Formats timestamp to relative time (e.g., \"Just now\", \"2 min ago\", \"1 hour ago\")\n * Similar to WhatsApp and Messenger\n */\nexport function formatMessageTime(timestamp: number | string): string {\n  const now = Date.now();\n  const messageTime = typeof timestamp === 'string' ? new Date(timestamp).getTime() : timestamp;\n  const diffMs = now - messageTime;\n  const diffSecs = Math.floor(diffMs / 1000);\n  const diffMins = Math.floor(diffSecs / 60);\n  const diffHours = Math.floor(diffMins / 60);\n  const diffDays = Math.floor(diffHours / 24);\n\n  if (diffSecs < 10) return 'Just now';\n  if (diffSecs < 60) return `${diffSecs}s ago`;\n  if (diffMins < 60) return `${diffMins}m ago`;\n  if (diffHours < 24) return `${diffHours}h ago`;\n  if (diffDays < 7) return `${diffDays}d ago`;\n\n  // For older messages, show date and time\n  const date = new Date(messageTime);\n  const today = new Date();\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n\n  if (date.toDateString() === today.toDateString()) {\n    return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });\n  } else if (date.toDateString() === yesterday.toDateString()) {\n    return `Yesterday ${date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`;\n  } else {\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: date.getFullYear() !== today.getFullYear() ? 'numeric' : undefined });\n  }\n}\n\n/**\n * Formats timestamp to full date and time for tooltips\n */\nexport function formatFullTimestamp(timestamp: number | string): string {\n  const messageTime = typeof timestamp === 'string' ? new Date(timestamp).getTime() : timestamp;\n  const date = new Date(messageTime);\n  return date.toLocaleString('en-US', {\n    month: 'short',\n    day: 'numeric',\n    year: 'numeric',\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: true,\n  });\n}\n\n/**\n * Groups messages by date for better organization\n * Useful for showing date separators like WhatsApp\n */\nexport function shouldShowDateSeparator(\n  currentMessage: { timestamp: number | string },\n  previousMessage?: { timestamp: number | string }\n): boolean {\n  if (!previousMessage) return true;\n\n  const currentDate = new Date(\n    typeof currentMessage.timestamp === 'string'\n      ? new Date(currentMessage.timestamp).getTime()\n      : currentMessage.timestamp\n  );\n  const previousDate = new Date(\n    typeof previousMessage.timestamp === 'string'\n      ? new Date(previousMessage.timestamp).getTime()\n      : previousMessage.timestamp\n  );\n\n  return (\n    currentDate.getDate() !== previousDate.getDate() ||\n    currentDate.getMonth() !== previousDate.getMonth() ||\n    currentDate.getFullYear() !== previousDate.getFullYear()\n  );\n}\n\n/**\n * Formats date separator (e.g., \"Today\", \"Yesterday\", \"December 25, 2024\")\n */\nexport function formatDateSeparator(timestamp: number | string): string {\n  const date = new Date(typeof timestamp === 'string' ? new Date(timestamp).getTime() : timestamp);\n  const today = new Date();\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n\n  if (date.toDateString() === today.toDateString()) {\n    return 'Today';\n  } else if (date.toDateString() === yesterday.toDateString()) {\n    return 'Yesterday';\n  } else {\n    return date.toLocaleDateString('en-US', {\n      weekday: 'long',\n      month: 'long',\n      day: 'numeric',\n      year: date.getFullYear() !== today.getFullYear() ? 'numeric' : undefined,\n    });\n  }\n}\n\n\n"],"names":[],"mappings":"AAAA;;;CAGC,GAED;;;CAGC;;;;;;;;;;AACM,SAAS,kBAAkB,SAA0B;IAC1D,MAAM,MAAM,KAAK,GAAG;IACpB,MAAM,cAAc,OAAO,cAAc,WAAW,IAAI,KAAK,WAAW,OAAO,KAAK;IACpF,MAAM,SAAS,MAAM;IACrB,MAAM,WAAW,KAAK,KAAK,CAAC,SAAS;IACrC,MAAM,WAAW,KAAK,KAAK,CAAC,WAAW;IACvC,MAAM,YAAY,KAAK,KAAK,CAAC,WAAW;IACxC,MAAM,WAAW,KAAK,KAAK,CAAC,YAAY;IAExC,IAAI,WAAW,IAAI,OAAO;IAC1B,IAAI,WAAW,IAAI,OAAO,GAAG,SAAS,KAAK,CAAC;IAC5C,IAAI,WAAW,IAAI,OAAO,GAAG,SAAS,KAAK,CAAC;IAC5C,IAAI,YAAY,IAAI,OAAO,GAAG,UAAU,KAAK,CAAC;IAC9C,IAAI,WAAW,GAAG,OAAO,GAAG,SAAS,KAAK,CAAC;IAE3C,yCAAyC;IACzC,MAAM,OAAO,IAAI,KAAK;IACtB,MAAM,QAAQ,IAAI;IAClB,MAAM,YAAY,IAAI,KAAK;IAC3B,UAAU,OAAO,CAAC,UAAU,OAAO,KAAK;IAExC,IAAI,KAAK,YAAY,OAAO,MAAM,YAAY,IAAI;QAChD,OAAO,KAAK,kBAAkB,CAAC,SAAS;YAAE,MAAM;YAAW,QAAQ;YAAW,QAAQ;QAAK;IAC7F,OAAO,IAAI,KAAK,YAAY,OAAO,UAAU,YAAY,IAAI;QAC3D,OAAO,CAAC,UAAU,EAAE,KAAK,kBAAkB,CAAC,SAAS;YAAE,MAAM;YAAW,QAAQ;YAAW,QAAQ;QAAK,IAAI;IAC9G,OAAO;QACL,OAAO,KAAK,kBAAkB,CAAC,SAAS;YAAE,OAAO;YAAS,KAAK;YAAW,MAAM,KAAK,WAAW,OAAO,MAAM,WAAW,KAAK,YAAY;QAAU;IACrJ;AACF;AAKO,SAAS,oBAAoB,SAA0B;IAC5D,MAAM,cAAc,OAAO,cAAc,WAAW,IAAI,KAAK,WAAW,OAAO,KAAK;IACpF,MAAM,OAAO,IAAI,KAAK;IACtB,OAAO,KAAK,cAAc,CAAC,SAAS;QAClC,OAAO;QACP,KAAK;QACL,MAAM;QACN,MAAM;QACN,QAAQ;QACR,QAAQ;IACV;AACF;AAMO,SAAS,wBACd,cAA8C,EAC9C,eAAgD;IAEhD,IAAI,CAAC,iBAAiB,OAAO;IAE7B,MAAM,cAAc,IAAI,KACtB,OAAO,eAAe,SAAS,KAAK,WAChC,IAAI,KAAK,eAAe,SAAS,EAAE,OAAO,KAC1C,eAAe,SAAS;IAE9B,MAAM,eAAe,IAAI,KACvB,OAAO,gBAAgB,SAAS,KAAK,WACjC,IAAI,KAAK,gBAAgB,SAAS,EAAE,OAAO,KAC3C,gBAAgB,SAAS;IAG/B,OACE,YAAY,OAAO,OAAO,aAAa,OAAO,MAC9C,YAAY,QAAQ,OAAO,aAAa,QAAQ,MAChD,YAAY,WAAW,OAAO,aAAa,WAAW;AAE1D;AAKO,SAAS,oBAAoB,SAA0B;IAC5D,MAAM,OAAO,IAAI,KAAK,OAAO,cAAc,WAAW,IAAI,KAAK,WAAW,OAAO,KAAK;IACtF,MAAM,QAAQ,IAAI;IAClB,MAAM,YAAY,IAAI,KAAK;IAC3B,UAAU,OAAO,CAAC,UAAU,OAAO,KAAK;IAExC,IAAI,KAAK,YAAY,OAAO,MAAM,YAAY,IAAI;QAChD,OAAO;IACT,OAAO,IAAI,KAAK,YAAY,OAAO,UAAU,YAAY,IAAI;QAC3D,OAAO;IACT,OAAO;QACL,OAAO,KAAK,kBAAkB,CAAC,SAAS;YACtC,SAAS;YACT,OAAO;YACP,KAAK;YACL,MAAM,KAAK,WAAW,OAAO,MAAM,WAAW,KAAK,YAAY;QACjE;IACF;AACF"}},
    {"offset": {"line": 246, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/components/ChatRoom.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { useRouter } from 'next/navigation';\nimport type { IMessage, StompSubscription } from \"@stomp/stompjs\";\nimport { getStompClient, waitForConnection } from \"@/lib/ws\";\nimport { formatMessageTime, formatFullTimestamp, shouldShowDateSeparator, formatDateSeparator } from \"../lib/chatUtils\";\n\nexport type ChatMessage = {\n  roomId?: string;\n  senderSessionId?: string;\n  message: string;\n  timestamp: number | string; // Epoch milliseconds (number) or ISO string\n  username?: string; // Optional, from backend\n};\n\nexport type MatchFound = {\n  roomId: string;\n  peerSessionId: string;\n};\n\nexport type ChatRoomProps = {\n  sessionId: string;\n  matchData: MatchFound;\n};\n\nexport default function ChatRoom({ sessionId, matchData }: ChatRoomProps) {\n  const [messages, setMessages] = useState<ChatMessage[]>([]);\n  const [input, setInput] = useState(\"\");\n  const [myUsername, setMyUsername] = useState<string>(\"\");\n  const [peerUsername, setPeerUsername] = useState<string>(\"\");\n  const [sessionEnded, setSessionEnded] = useState(false);\n  const [finding, setFinding] = useState(false);\n  const API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8080';\n  const router = useRouter();\n \n\n  const subscriptionRef = useRef<StompSubscription | null>(null);\n  const didSubscribeRef = useRef(false);\n  const sessionIdRef = useRef<string>(sessionId);\n\n   // Handler function for processing messages\n   const handleMessage = (messageBody: string) => {\n    try {\n      const data = JSON.parse(messageBody) as ChatMessage;\n      \n      // Validate message structure\n      if (data && typeof data.message === 'string') {\n          // If this is a system 'Session ended.' message, clear previous messages and stop\n          if (data.username === 'system' && data.message === 'Session ended.') {\n            setMessages([{ ...data, timestamp: Date.now() }]);\n            // unsubscribe\n            if (subscriptionRef.current) {\n              subscriptionRef.current.unsubscribe();\n              subscriptionRef.current = null;\n            }\n            setSessionEnded(true);\n            sessionStorage.removeItem('matchData');\n            // navigate back to home\n            router.push('/');\n            return;\n          }\n        // Track peer's username from their messages\n        if (data.senderSessionId && data.senderSessionId !== sessionIdRef.current) {\n          if (data.username) {\n            setPeerUsername(data.username);\n          }\n        }\n        \n        // Ensure roomId and senderSessionId are set for room-based chat\n        const roomMessage: ChatMessage = {\n          ...data,\n          roomId: matchData.roomId,\n          senderSessionId: data.senderSessionId || sessionIdRef.current,\n          timestamp: data.timestamp || Date.now(),\n        };\n        \n        setMessages((prev) => [...prev, roomMessage]);\n      }\n    } catch (error) {\n      console.error(\"Failed to parse chat message:\", error);\n    }\n  };\n\n  const setupConnection = async (isMounted: boolean) => {\n    try {\n      const client = getStompClient();\n      await waitForConnection(client);\n\n      if (!isMounted) return;\n\n      // React StrictMode can run effects twice in dev; guard to avoid double subscribe\n      if (didSubscribeRef.current) return;\n      didSubscribeRef.current = true;\n\n      // Subscribe to room-specific topic\n      subscriptionRef.current = client.subscribe(\n        `/topic/chat/${matchData.roomId}`,\n        (message: IMessage) => handleMessage(message.body)\n      );\n    } catch (error) {\n      console.error(\"Failed to setup chat connection:\", error);\n    }\n  };\n  \n  // Generate or retrieve username for current user\n  useEffect(() => {\n    const storedUsername = sessionStorage.getItem(`chat_username_${sessionId}`);\n    if (storedUsername) {\n      setMyUsername(storedUsername);\n    } else {\n      // Generate a unique guest username using sessionId (UUID) to ensure uniqueness\n      // Each UUID is unique, so we use multiple parts of it to create a unique numeric identifier\n      const uuidHex = sessionId.replace(/-/g, '');\n      // Use parts from different sections of the UUID and combine them\n      const part1 = parseInt(uuidHex.substring(0, 6), 16);\n      const part2 = parseInt(uuidHex.substring(8, 14), 16);\n      const part3 = parseInt(uuidHex.substring(16, 22), 16);\n      // Combine all parts using XOR to distribute values better\n      const combined = (part1 ^ part2 ^ part3) % 99999999;\n      const usernameSuffix = String(combined + 1).padStart(8, '0'); // +1 to avoid 00000000\n      const username = `Friend${usernameSuffix}`;\n      sessionStorage.setItem(`chat_username_${sessionId}`, username);\n      setMyUsername(username);\n    }\n  }, [sessionId]);\n\n  // Keep sessionId ref updated\n  useEffect(() => {\n    sessionIdRef.current = sessionId;\n  }, [sessionId]);\n\n  useEffect(() => {\n    let isMounted = true;\n    setupConnection(isMounted);\n\n    return () => {\n      isMounted = false;\n      didSubscribeRef.current = false;\n\n      if (subscriptionRef.current) {\n        subscriptionRef.current.unsubscribe();\n        subscriptionRef.current = null;\n      }\n      setSessionEnded(false);\n    };\n  }, [matchData.roomId]);\n\n  const sendMessage = async () => {\n    const messageText = input.trim();\n    if (!messageText) return;\n\n    if (sessionEnded || finding) return;\n\n    try {\n      // Moderate message before sending\n      const moderationResponse = await fetch('/api/moderate', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ message: messageText }),\n      });\n\n      const moderationResult = await moderationResponse.json();\n\n      if (!moderationResult.isAppropriate) {\n        alert(`Message cannot be sent: ${moderationResult.reason || 'Content violates community guidelines'}`);\n        return;\n      }\n\n      const client = getStompClient();\n      await waitForConnection(client);\n\n      const chatMessage = {\n        roomId: matchData.roomId,\n        senderSessionId: sessionId,\n        message: messageText,\n        username: myUsername, // Send our username so backend can use it\n      };\n\n      client.publish({\n        destination: \"/app/chat.send\",\n        body: JSON.stringify(chatMessage),\n      });\n\n      setInput(\"\");\n    } catch (error) {\n      console.error(\"Failed to send message:\", error);\n      alert(\"Failed to send message. Please try again.\");\n    }\n  };\n\n  const endSession = async () => {\n    try {\n      await fetch(`${API_BASE}/api/session/${sessionId}/end`, { method: 'POST' });\n    } catch (e) {\n      // ignore errors\n    }\n\n    // Clear UI and stop subscribing\n    if (subscriptionRef.current) {\n      subscriptionRef.current.unsubscribe();\n      subscriptionRef.current = null;\n    }\n    setMessages([]);\n    setSessionEnded(true);\n    // show neutral system message locally then navigate to home\n    sessionStorage.removeItem('matchData');\n    router.push('/');\n  };\n\n  const changeFriend = async () => {\n    // retrieve matchingData (mood/age/country) to provide to backend\n    const matchingDataRaw = sessionStorage.getItem('matchingData');\n    let body = {} as any;\n    if (matchingDataRaw) {\n      try { body = JSON.parse(matchingDataRaw); } catch { body = {}; }\n    }\n\n    try {\n      await fetch(`${API_BASE}/api/session/${sessionId}/change-friend`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(body),\n      });\n    } catch (e) {\n      // ignore\n    }\n\n    // Clear UI and show finding state\n    if (subscriptionRef.current) {\n      subscriptionRef.current.unsubscribe();\n      subscriptionRef.current = null;\n    }\n    setMessages([]);\n    setFinding(true);\n    // navigate to matching which will enqueue and find a new friend\n    router.push('/matching');\n  };\n\n  return (\n    <div className=\"h-[calc(100vh-4rem)] flex flex-col\">\n      <div className=\"bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 mb-4\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"h4 text-white mb-1\">Chat Room</h2>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-2 h-2 bg-green-400 rounded-full animate-pulse\"></div>\n              <p className=\"text-sm text-white/80\">\n                {peerUsername \n                  ? `Connected to ${peerUsername}`\n                  : \"Connected\"}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            <button onClick={changeFriend} className=\"px-3 py-2 bg-white/10 text-white rounded-md hover:bg-white/20\">Change Friend</button>\n            <button onClick={endSession} className=\"px-3 py-2 bg-red-600 text-white rounded-md hover:opacity-90\">End Session</button>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 overflow-y-auto mb-4 min-h-0\">\n        {messages.length === 0 ? (\n          <div className=\"text-center text-white/60 mt-8\">\n            <h3 className=\"h3 text-white mb-1\">Start the conversation!</h3>\n          </div>\n        ) : (\n          <div className=\"space-y-3\">\n            {messages.map((m, idx) => {\n              const isMyMessage = m.senderSessionId === sessionIdRef.current;\n              const timestamp = typeof m.timestamp === 'string' ? new Date(m.timestamp).getTime() : m.timestamp;\n              const showDateSeparator = shouldShowDateSeparator(m, messages[idx - 1]);\n              \n              return (\n                <div key={idx}>\n                  {showDateSeparator && (\n                    <div className=\"flex justify-center my-4\">\n                      <span className=\"text-xs text-white/50 bg-white/10 px-3 py-1 rounded-full\">\n                        {formatDateSeparator(timestamp)}\n                      </span>\n                    </div>\n                  )}\n                  <div className={`flex ${isMyMessage ? 'justify-end' : 'justify-start'} mb-1`}\n                  >\n                    <div \n                      className={`max-w-[75%] sm:max-w-[65%] ${\n                        isMyMessage \n                          ? 'bg-blue-600 text-white rounded-2xl rounded-tr-sm' \n                          : 'bg-white/20 text-white rounded-2xl rounded-tl-sm'\n                      } px-4 py-2.5 shadow-sm`}\n                      title={formatFullTimestamp(timestamp)}\n                    >\n                      <div className=\"text-sm sm:text-base wrap-break-word leading-relaxed\">\n                        {m.message}\n                      </div>\n                      <div className={`text-[10px] opacity-70 mt-1.5 flex ${isMyMessage ? 'justify-end' : 'justify-start'}`}>\n                        {formatMessageTime(timestamp)}\n                      </div>\n                    </div>\n                    </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      <div className=\"flex gap-2 items-end\">\n        <div className=\"flex-1 relative\">\n          <textarea\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            placeholder=\"Type a message...\"\n            rows={1}\n            className=\"w-full p-3 sm:p-4 text-base bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 focus:bg-white/20 resize-none min-h-[48px] max-h-32 overflow-y-auto scrollbar-hide\"\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\" && !e.shiftKey) {\n                e.preventDefault();\n                sendMessage();\n              }\n            }}\n            style={{\n              height: 'auto',\n            }}\n            onInput={(e) => {\n              const target = e.target as HTMLTextAreaElement;\n              target.style.height = 'auto';\n              target.style.height = `${Math.min(target.scrollHeight, 128)}px`;\n            }}\n          />\n        </div>\n        <button \n          onClick={sendMessage}\n          disabled={!input.trim()}\n          className=\"px-5 sm:px-6 py-3 sm:py-4 bg-white height-8 text-blue-600 rounded-2xl font-medium hover:bg-white/90 active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-white/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white flex items-center justify-center min-w-[64px]\"\n        >\n          <svg \n            xmlns=\"http://www.w3.org/2000/svg\" \n            viewBox=\"0 0 20 20\" \n            fill=\"currentColor\" \n            className=\"w-5 h-9\"\n          >\n            <path d=\"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z\" />\n          </svg>\n        </button>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 720, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/app/chat/%5BroomId%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useParams, useRouter } from 'next/navigation';\nimport ChatRoom from '@/components/ChatRoom';\n\nexport default function ChatRoomPage() {\n  const params = useParams();\n  const router = useRouter();\n  const roomId = params.roomId as string;\n  \n  const [sessionId, setSessionId] = useState<string | null>(null);\n  const [matchData, setMatchData] = useState<{ roomId: string; peerSessionId: string } | null>(null);\n  const [mounted, setMounted] = useState(false);\n\n  useEffect(() => {\n    // Mark as mounted to indicate we're on the client\n    setMounted(true);\n    \n    // Only access sessionStorage on the client side (sessionStorage is per-tab, localStorage is shared)\n    const storedSessionId = sessionStorage.getItem('sessionId');\n    const savedMatchData = sessionStorage.getItem('matchData');\n    \n    setSessionId(storedSessionId);\n    \n    if (savedMatchData) {\n      try {\n        const parsed = JSON.parse(savedMatchData);\n        // Verify the roomId matches\n        if (parsed.roomId === roomId) {\n          setMatchData(parsed);\n        } else {\n          setMatchData(null);\n        }\n      } catch {\n        setMatchData(null);\n      }\n    } else {\n      setMatchData(null);\n    }\n  }, [roomId]);\n\n  useEffect(() => {\n    if (!mounted) return;\n    \n    if (!sessionId) {\n      router.push('/');\n      return;\n    }\n\n    if (!roomId) {\n      router.push('/matching');\n      return;\n    }\n\n    if (!matchData) {\n      router.push('/matching');\n      return;\n    }\n  }, [sessionId, roomId, matchData, router, mounted]);\n\n  // Always show loading until mounted and data is loaded\n  if (!mounted || !sessionId || !matchData) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center gradient-bg\">\n        <div className=\"text-white text-lg\">Loading...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen gradient-bg\">\n      <div className=\"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8\">\n        <ChatRoom sessionId={sessionId} matchData={matchData} />\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,SAAS,OAAO,MAAM;IAE5B,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAgB;IAC1D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAmD;IAC7F,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACR,kDAAkD;QAClD,WAAW;QAEX,oGAAoG;QACpG,MAAM,kBAAkB,eAAe,OAAO,CAAC;QAC/C,MAAM,iBAAiB,eAAe,OAAO,CAAC;QAE9C,aAAa;QAEb,IAAI,gBAAgB;YAClB,IAAI;gBACF,MAAM,SAAS,KAAK,KAAK,CAAC;gBAC1B,4BAA4B;gBAC5B,IAAI,OAAO,MAAM,KAAK,QAAQ;oBAC5B,aAAa;gBACf,OAAO;oBACL,aAAa;gBACf;YACF,EAAE,OAAM;gBACN,aAAa;YACf;QACF,OAAO;YACL,aAAa;QACf;IACF,GAAG;QAAC;KAAO;IAEX,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,SAAS;QAEd,IAAI,CAAC,WAAW;YACd,OAAO,IAAI,CAAC;YACZ;QACF;QAEA,IAAI,CAAC,QAAQ;YACX,OAAO,IAAI,CAAC;YACZ;QACF;QAEA,IAAI,CAAC,WAAW;YACd,OAAO,IAAI,CAAC;YACZ;QACF;IACF,GAAG;QAAC;QAAW;QAAQ;QAAW;QAAQ;KAAQ;IAElD,uDAAuD;IACvD,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,WAAW;QACxC,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAqB;;;;;;;;;;;IAG1C;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC,kIAAQ;gBAAC,WAAW;gBAAW,WAAW;;;;;;;;;;;;;;;;AAInD"}}]
}