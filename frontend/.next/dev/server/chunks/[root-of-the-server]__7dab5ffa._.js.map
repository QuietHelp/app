{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/tarbipyakurel/Desktop/QuietHelp-app/frontend/app/api/moderate/route.ts"],"sourcesContent":["import { generateText } from \"ai\"\nimport { google } from \"@ai-sdk/google\"\n\nexport async function POST(req: Request) {\n  try {\n    const { message } = await req.json()\n\n    if (!message || typeof message !== \"string\") {\n      return Response.json({ isAppropriate: false, reason: \"Invalid message\" })\n    }\n\n    // Use AI to check if the message is appropriate\n    const { text } = await generateText({\n      model: google(\"gemini-2.0-flash-exp\"),\n      prompt: `You are a content moderator for a friendly anonymous chat app. Analyze the following message and determine if it contains:\n- Hate speech, harassment, or bullying\n- Sexual or explicit content\n- Violence or threats\n- Spam or excessive negativity\n- Personal information sharing\n\nMessage: \"${message}\"\n\nRespond with ONLY \"APPROPRIATE\" or \"INAPPROPRIATE: [brief reason]\"`,\n      temperature: 0.3,\n    })\n\n    const isAppropriate = text.trim().toUpperCase().startsWith(\"APPROPRIATE\")\n    const reason = isAppropriate ? null : text.replace(/^INAPPROPRIATE:\\s*/i, \"\").trim()\n\n    console.log(\"[Moderation] Result:\", { message, isAppropriate, reason })\n\n    return Response.json({\n      isAppropriate,\n      reason,\n    })\n  } catch (error) {\n    console.error(\"[Moderation] Error:\", error)\n    // Fail open - allow message if moderation fails\n    return Response.json({ isAppropriate: true })\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,IAAI;QAElC,IAAI,CAAC,WAAW,OAAO,YAAY,UAAU;YAC3C,OAAO,SAAS,IAAI,CAAC;gBAAE,eAAe;gBAAO,QAAQ;YAAkB;QACzE;QAEA,gDAAgD;QAChD,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,IAAA,sKAAY,EAAC;YAClC,OAAO,IAAA,mKAAM,EAAC;YACd,QAAQ,CAAC;;;;;;;UAOL,EAAE,QAAQ;;kEAE8C,CAAC;YAC7D,aAAa;QACf;QAEA,MAAM,gBAAgB,KAAK,IAAI,GAAG,WAAW,GAAG,UAAU,CAAC;QAC3D,MAAM,SAAS,gBAAgB,OAAO,KAAK,OAAO,CAAC,uBAAuB,IAAI,IAAI;QAElF,QAAQ,GAAG,CAAC,wBAAwB;YAAE;YAAS;YAAe;QAAO;QAErE,OAAO,SAAS,IAAI,CAAC;YACnB;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,gDAAgD;QAChD,OAAO,SAAS,IAAI,CAAC;YAAE,eAAe;QAAK;IAC7C;AACF"}}]
}