(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,r)=>{t.exports=e.r(76562)},29500,e=>{"use strict";var t=e.i(15636),r=e.i(31592);let s=null;function n(){return s||(s=new t.Client({webSocketFactory:()=>new r.default("http://localhost:8080/ws"),reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3,onConnect:()=>console.log("WebSocket connected"),onDisconnect:()=>console.log("WebSocket disconnected"),onStompError:e=>{console.error("STOMP error:",e.headers.message,e.body)}})).activate(),s}function a(e){return new Promise(t=>{if(e.connected)return t();let r=e.onConnect;e.onConnect=s=>{r&&r(s),t(),e.onConnect=r??(()=>{})}})}e.s(["getStompClient",()=>n,"waitForConnection",()=>a])},8640,e=>{"use strict";function t(e){let t=Date.now(),r="string"==typeof e?new Date(e).getTime():e,s=Math.floor((t-r)/1e3),n=Math.floor(s/60),a=Math.floor(n/60),i=Math.floor(a/24);if(s<10)return"Just now";if(s<60)return`${s}s ago`;if(n<60)return`${n}m ago`;if(a<24)return`${a}h ago`;if(i<7)return`${i}d ago`;let o=new Date(r),l=new Date,c=new Date(l);return(c.setDate(c.getDate()-1),o.toDateString()===l.toDateString())?o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):o.toDateString()===c.toDateString()?`Yesterday ${o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`:o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:o.getFullYear()!==l.getFullYear()?"numeric":void 0})}function r(e){return new Date("string"==typeof e?new Date(e).getTime():e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function s(e,t){if(!t)return!0;let r=new Date("string"==typeof e.timestamp?new Date(e.timestamp).getTime():e.timestamp),s=new Date("string"==typeof t.timestamp?new Date(t.timestamp).getTime():t.timestamp);return r.getDate()!==s.getDate()||r.getMonth()!==s.getMonth()||r.getFullYear()!==s.getFullYear()}function n(e){let t=new Date("string"==typeof e?new Date(e).getTime():e),r=new Date,s=new Date(r);return(s.setDate(s.getDate()-1),t.toDateString()===r.toDateString())?"Today":t.toDateString()===s.toDateString()?"Yesterday":t.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:t.getFullYear()!==r.getFullYear()?"numeric":void 0})}e.s(["formatDateSeparator",()=>n,"formatFullTimestamp",()=>r,"formatMessageTime",()=>t,"shouldShowDateSeparator",()=>s])},98655,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(18566),n=e.i(29500),a=e.i(8640);function i({sessionId:e,matchData:s}){let[i,o]=(0,r.useState)([]),[l,c]=(0,r.useState)(""),[m,d]=(0,r.useState)(""),[u,h]=(0,r.useState)(""),g=(0,r.useRef)(null),f=(0,r.useRef)(!1),p=(0,r.useRef)(e),x=async e=>{try{let t=(0,n.getStompClient)();if(await (0,n.waitForConnection)(t),!e||f.current)return;f.current=!0,g.current=t.subscribe(`/topic/chat/${s.roomId}`,e=>(e=>{try{let t=JSON.parse(e);if(t&&"string"==typeof t.message){t.senderSessionId&&t.senderSessionId!==p.current&&t.username&&h(t.username);let e={...t,roomId:s.roomId,senderSessionId:t.senderSessionId||p.current,timestamp:t.timestamp||Date.now()};o(t=>[...t,e])}}catch(e){console.error("Failed to parse chat message:",e)}})(e.body))}catch(e){console.error("Failed to setup chat connection:",e)}};(0,r.useEffect)(()=>{let t=sessionStorage.getItem(`chat_username_${e}`);if(t)d(t);else{let t=e.replace(/-/g,""),r=String((parseInt(t.substring(0,6),16)^parseInt(t.substring(8,14),16)^parseInt(t.substring(16,22),16))%0x5f5e0ff+1).padStart(8,"0"),s=`Friend${r}`;sessionStorage.setItem(`chat_username_${e}`,s),d(s)}},[e]),(0,r.useEffect)(()=>{p.current=e},[e]),(0,r.useEffect)(()=>(x(!0),()=>{f.current=!1,g.current&&(g.current.unsubscribe(),g.current=null)}),[s.roomId]);let w=async()=>{let t=l.trim();if(t)try{let r=await fetch("/api/moderate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})}),a=await r.json();if(!a.isAppropriate)return void alert(`Message cannot be sent: ${a.reason||"Content violates community guidelines"}`);let i=(0,n.getStompClient)();await (0,n.waitForConnection)(i);let o={roomId:s.roomId,senderSessionId:e,message:t,username:m};i.publish({destination:"/app/chat.send",body:JSON.stringify(o)}),c("")}catch(e){console.error("Failed to send message:",e),alert("Failed to send message. Please try again.")}};return(0,t.jsxs)("div",{className:"h-[calc(100vh-4rem)] flex flex-col",children:[(0,t.jsx)("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 mb-4",children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"h4 text-white mb-1",children:"Chat Room"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),(0,t.jsx)("p",{className:"text-sm text-white/80",children:u?`Connected to ${u}`:"Connected"})]})]})})}),(0,t.jsx)("div",{className:"flex-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 overflow-y-auto mb-4 min-h-0",children:0===i.length?(0,t.jsx)("div",{className:"text-center text-white/60 mt-8",children:(0,t.jsx)("h3",{className:"h3 text-white mb-1",children:"Start the conversation!"})}):(0,t.jsx)("div",{className:"space-y-3",children:i.map((e,r)=>{let s=e.senderSessionId===p.current,n="string"==typeof e.timestamp?new Date(e.timestamp).getTime():e.timestamp,o=(0,a.shouldShowDateSeparator)(e,i[r-1]);return(0,t.jsxs)("div",{children:[o&&(0,t.jsx)("div",{className:"flex justify-center my-4",children:(0,t.jsx)("span",{className:"text-xs text-white/50 bg-white/10 px-3 py-1 rounded-full",children:(0,a.formatDateSeparator)(n)})}),(0,t.jsx)("div",{className:`flex ${s?"justify-end":"justify-start"} mb-1`,children:(0,t.jsxs)("div",{className:`max-w-[75%] sm:max-w-[65%] ${s?"bg-blue-600 text-white rounded-2xl rounded-tr-sm":"bg-white/20 text-white rounded-2xl rounded-tl-sm"} px-4 py-2.5 shadow-sm`,title:(0,a.formatFullTimestamp)(n),children:[(0,t.jsx)("div",{className:"text-sm sm:text-base wrap-break-word leading-relaxed",children:e.message}),(0,t.jsx)("div",{className:`text-[10px] opacity-70 mt-1.5 flex ${s?"justify-end":"justify-start"}`,children:(0,a.formatMessageTime)(n)})]})})]},r)})})}),(0,t.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,t.jsx)("div",{className:"flex-1 relative",children:(0,t.jsx)("textarea",{value:l,onChange:e=>c(e.target.value),placeholder:"Type a message...",rows:1,className:"w-full p-3 sm:p-4 text-base bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 focus:bg-white/20 resize-none min-h-[48px] max-h-32 overflow-y-auto scrollbar-hide",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w())},style:{height:"auto"},onInput:e=>{let t=e.target;t.style.height="auto",t.style.height=`${Math.min(t.scrollHeight,128)}px`}})}),(0,t.jsx)("button",{onClick:w,disabled:!l.trim(),className:"px-5 sm:px-6 py-3 sm:py-4 bg-white height-8 text-blue-600 rounded-2xl font-medium hover:bg-white/90 active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-white/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white flex items-center justify-center min-w-[64px]",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-9",children:(0,t.jsx)("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})})})]})]})}function o(){let e=(0,s.useParams)(),n=(0,s.useRouter)(),a=e.roomId,[o,l]=(0,r.useState)(null),[c,m]=(0,r.useState)(null),[d,u]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{u(!0);let e=sessionStorage.getItem("sessionId"),t=sessionStorage.getItem("matchData");if(l(e),t)try{let e=JSON.parse(t);e.roomId===a?m(e):m(null)}catch{m(null)}else m(null)},[a]),(0,r.useEffect)(()=>{if(d){if(!o)return void n.push("/");if(!a||!c)return void n.push("/matching")}},[o,a,c,n,d]),d&&o&&c)?(0,t.jsx)("div",{className:"min-h-screen gradient-bg",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8",children:(0,t.jsx)(i,{sessionId:o,matchData:c})})}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center gradient-bg",children:(0,t.jsx)("div",{className:"text-white text-lg",children:"Loading..."})})}e.s(["default",()=>o],98655)}]);