(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72292,75254,e=>{"use strict";var t=e.i(71645);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},a=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:o="",children:l,iconNode:c,...u},d)=>(0,t.createElement)("svg",{ref:d,...s,width:r,height:r,stroke:e,strokeWidth:i?24*Number(n)/Number(r):n,className:a("lucide",o),...!l&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(u)&&{"aria-hidden":"true"},...u},[...c.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(l)?l:[l]])),i=(e,s)=>{let i=(0,t.forwardRef)(({className:i,...o},l)=>(0,t.createElement)(n,{ref:l,iconNode:s,className:a(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,i),...o}));return i.displayName=r(e),i};e.s(["default",()=>i],75254);let o=i("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);e.s(["GlobeIcon",()=>o],72292)},8640,e=>{"use strict";function t(e){let t=Date.now(),r="string"==typeof e?new Date(e).getTime():e,a=Math.floor((t-r)/1e3),s=Math.floor(a/60),n=Math.floor(s/60),i=Math.floor(n/24);if(a<10)return"Just now";if(a<60)return`${a}s ago`;if(s<60)return`${s}m ago`;if(n<24)return`${n}h ago`;if(i<7)return`${i}d ago`;let o=new Date(r),l=new Date,c=new Date(l);return(c.setDate(c.getDate()-1),o.toDateString()===l.toDateString())?o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):o.toDateString()===c.toDateString()?`Yesterday ${o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`:o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:o.getFullYear()!==l.getFullYear()?"numeric":void 0})}function r(e){return new Date("string"==typeof e?new Date(e).getTime():e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function a(e,t){if(!t)return!0;let r=new Date("string"==typeof e.timestamp?new Date(e.timestamp).getTime():e.timestamp),a=new Date("string"==typeof t.timestamp?new Date(t.timestamp).getTime():t.timestamp);return r.getDate()!==a.getDate()||r.getMonth()!==a.getMonth()||r.getFullYear()!==a.getFullYear()}function s(e){let t=new Date("string"==typeof e?new Date(e).getTime():e),r=new Date,a=new Date(r);return(a.setDate(a.getDate()-1),t.toDateString()===r.toDateString())?"Today":t.toDateString()===a.toDateString()?"Yesterday":t.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:t.getFullYear()!==r.getFullYear()?"numeric":void 0})}e.s(["formatDateSeparator",()=>s,"formatFullTimestamp",()=>r,"formatMessageTime",()=>t,"shouldShowDateSeparator",()=>a])},75976,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(47167),s=e.i(15636),n=e.i(31592),i=e.i(8640),o=e.i(72292);let l=a.default.env.NEXT_PUBLIC_WS_URL||"http://localhost:8080/ws";function c({sessionId:e}){let[a,c]=(0,r.useState)([]),[u,d]=(0,r.useState)(""),[m,h]=(0,r.useState)(!1),[g,f]=(0,r.useState)(null),x=(0,r.useRef)(null),p=(0,r.useRef)(e),w=(0,r.useRef)(null),b=(0,r.useRef)(null),y=(0,r.useRef)("");(0,r.useEffect)(()=>{let e=localStorage.getItem("chat_username_broadcast");if(!e){let t=Date.now().toString().slice(-6),r=Math.floor(1e3*Math.random());e=`Guest${t}${r}`,localStorage.setItem("chat_username_broadcast",e)}y.current=e},[]);let v=(0,r.useCallback)(async()=>{try{let e=await fetch("http://localhost:8080/api/chat/history");if(!e.ok)throw Error("Failed to load chat history");let t=await e.json();t.messages&&Array.isArray(t.messages)&&c(t.messages)}catch(e){console.error("Error loading chat history:",e)}},[]),j=(0,r.useCallback)(()=>{try{x.current&&x.current.deactivate();let e=new s.Client({webSocketFactory:()=>new n.default(l),reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3,onConnect:()=>{h(!0),f(null),w.current=e.subscribe("/topic/chat",e=>{try{let t=JSON.parse(e.body);t&&"string"==typeof t.username&&"string"==typeof t.message&&c(e=>[...e,t])}catch(e){console.error("Error parsing message:",e)}})},onDisconnect:()=>{h(!1),w.current=null},onStompError:e=>{console.error("STOMP error:",e.headers.message,e.body),f("Connection error. Reconnecting...")},onWebSocketError:e=>{console.error("WebSocket error:",e),f("Connection error. Reconnecting...")}});x.current=e,e.activate()}catch(e){console.error("Error connecting to WebSocket:",e),f("Failed to connect. Retrying..."),b.current=setTimeout(()=>{j()},5e3)}},[]);(0,r.useEffect)(()=>{p.current=e},[e]),(0,r.useEffect)(()=>(v(),j(),()=>{b.current&&clearTimeout(b.current),w.current&&w.current.unsubscribe(),x.current&&x.current.deactivate()}),[j,v]);let S=(0,r.useCallback)(()=>{x.current&&x.current.connected||j()},[j]),D=(0,r.useCallback)(async()=>{let t=u.trim();if(t&&x.current&&x.current.connected)try{let r=await fetch("/api/moderate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})}),a=await r.json();if(!a.isAppropriate){f(`Message cannot be sent: ${a.reason||"Content violates community guidelines"}`),setTimeout(()=>f(null),5e3);return}let s={message:t,username:y.current,senderSessionId:e};x.current.publish({destination:"/app/chat.send",body:JSON.stringify(s)}),d(""),f(null)}catch(e){console.error("Error sending message:",e),f("Failed to send message. Please try again.")}},[u,e]);return(0,t.jsxs)("div",{className:"h-[calc(100vh-4rem)] flex flex-col",children:[(0,t.jsxs)("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"h4 text-white mb-1 flex items-center gap-2",children:["Global Chat ",(0,t.jsx)(o.GlobeIcon,{className:"w-4 h-4 text-blue-600"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:`w-2 h-2 rounded-full ${m?"bg-green-400 animate-pulse":"bg-yellow-400"}`}),(0,t.jsx)("p",{className:"text-sm text-white/80",children:m?"Connected":"Connecting..."})]})]}),!m&&(0,t.jsx)("button",{onClick:S,className:"text-xs text-blue-300 hover:text-blue-200 underline px-2 py-1",children:"Reconnect"})]}),g&&(0,t.jsx)("p",{className:"text-xs text-red-300 mt-2",children:g})]}),(0,t.jsx)("div",{className:"flex-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-lg p-4 sm:p-6 overflow-y-auto mb-4 min-h-0",children:0===a.length?(0,t.jsx)("div",{className:"text-center text-white/60 mt-8",children:(0,t.jsx)("h3",{className:"h3 text-white mb-1",children:"Start the conversation!"})}):(0,t.jsx)("div",{className:"space-y-3",children:a.map((e,r)=>{let s=e.senderSessionId===p.current,n="string"==typeof e.timestamp?new Date(e.timestamp).getTime():e.timestamp,o=(0,i.shouldShowDateSeparator)(e,a[r-1]);return(0,t.jsxs)("div",{children:[o&&(0,t.jsx)("div",{className:"flex justify-center my-4",children:(0,t.jsx)("span",{className:"text-xs text-white/50 bg-white/10 px-3 py-1 rounded-full",children:(0,i.formatDateSeparator)(n)})}),(0,t.jsx)("div",{className:`flex ${s?"justify-end":"justify-start"} mb-1`,children:(0,t.jsxs)("div",{className:`max-w-[75%] sm:max-w-[65%] ${s?"bg-blue-600 text-white rounded-2xl rounded-tr-sm":"bg-white/20 text-white rounded-2xl rounded-tl-sm"} px-4 py-2.5 shadow-sm`,title:(0,i.formatFullTimestamp)(n),children:[(0,t.jsx)("div",{className:"text-xs font-medium mb-1 opacity-90",children:e.username||"Guest"}),(0,t.jsx)("div",{className:"text-sm sm:text-base wrap-break-word leading-relaxed",children:e.message}),(0,t.jsx)("div",{className:`text-[10px] opacity-70 mt-1.5 flex ${s?"justify-end":"justify-start"}`,children:(0,i.formatMessageTime)(n)})]})})]},r)})})}),(0,t.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,t.jsx)("div",{className:"flex-1 relative",children:(0,t.jsx)("textarea",{value:u,onChange:e=>d(e.target.value),placeholder:"Type a message...",rows:1,className:"w-full p-3 sm:p-4 text-base bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 focus:bg-white/20 resize-none min-h-[48px] max-h-32 overflow-y-auto scrollbar-hide disabled:opacity-50",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),D())},disabled:!m,style:{height:"auto"},onInput:e=>{let t=e.target;t.style.height="auto",t.style.height=`${Math.min(t.scrollHeight,128)}px`}})}),(0,t.jsx)("button",{onClick:D,disabled:!m||!u.trim(),className:"px-5 sm:px-6 py-3 sm:py-4 bg-white text-blue-600 rounded-2xl font-medium hover:bg-white/90 active:scale-95 transition-all focus:outline-none focus:ring-2 focus:ring-white/50 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white flex items-center justify-center min-w-[64px]",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:(0,t.jsx)("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})})})]})]})}function u(){let[e,a]=(0,r.useState)(null),[s,n]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{n(!0);let e=sessionStorage.getItem("sessionId");if(!e){let t=crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;sessionStorage.setItem("sessionId",t),e=t}a(e)},[]),s&&e)?(0,t.jsx)("div",{className:"h-full overflow-auto",children:(0,t.jsx)("div",{className:"min-h-screen flex flex-col p-4 sm:p-6 lg:p-8 gradient-bg",children:(0,t.jsx)("main",{className:"grow flex items-center justify-center",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto w-full",children:(0,t.jsx)(c,{sessionId:e})})})})}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center gradient-bg",children:(0,t.jsx)("div",{className:"text-white text-lg",children:"Loading..."})})}e.s(["default",()=>u],75976)}]);