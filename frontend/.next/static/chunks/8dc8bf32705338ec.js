(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,n)=>{t.exports=e.r(76562)},29500,e=>{"use strict";var t=e.i(15636),n=e.i(31592);let r=null;function s(){return r||(r=new t.Client({webSocketFactory:()=>new n.default("http://localhost:8080/ws"),reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3,onConnect:()=>console.log("WebSocket connected"),onDisconnect:()=>console.log("WebSocket disconnected"),onStompError:e=>{console.error("STOMP error:",e.headers.message,e.body)}})).activate(),r}function o(e){return new Promise(t=>{if(e.connected)return t();let n=e.onConnect;e.onConnect=r=>{n&&n(r),t(),e.onConnect=n??(()=>{})}})}e.s(["getStompClient",()=>s,"waitForConnection",()=>o])},65698,e=>{"use strict";var t=e.i(43476),n=e.i(71645),r=e.i(18566),s=e.i(29500);function o({sessionId:e,mood:r,age:o,country:c,onMatchFound:i}){let l=(0,n.useRef)(null),a=(0,n.useRef)(!1),u=(0,n.useRef)(i);return(0,n.useEffect)(()=>{u.current=i},[i]),(0,n.useEffect)(()=>{let t=!0;return(async()=>{try{let n=(0,s.getStompClient)();if(await (0,s.waitForConnection)(n),!t||a.current)return;a.current=!0,l.current=n.subscribe(`/topic/match/${e}`,e=>{try{let t=JSON.parse(e.body);u.current(t)}catch(e){console.error("Failed to parse match message:",e)}}),n.publish({destination:"/app/match.join",body:JSON.stringify({sessionId:e,mood:r,age:o,country:c})})}catch(e){console.error("Failed to setup WebSocket:",e)}})(),()=>{t=!1,a.current=!1,l.current&&(l.current.unsubscribe(),l.current=null)}},[e,r,o,c]),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"h1 text-white mb-4 sm:mb-6",children:"Looking for someone..."}),(0,t.jsx)("p",{className:"text-lg sm:text-xl text-white/90",children:"We're finding someone who understands."}),(0,t.jsx)("div",{className:"mt-8 flex justify-center",children:(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-4 border-white/30 border-t-white"})}),(0,t.jsx)("footer",{className:"mt-8 text-white/70 text-sm"})]})}function c(){let e=(0,r.useRouter)(),[s,c]=(0,n.useState)(null),[i,l]=(0,n.useState)(null),[a,u]=(0,n.useState)(!1);(0,n.useEffect)(()=>{u(!0),c(sessionStorage.getItem("sessionId"));let e=sessionStorage.getItem("matchingData");if(e)try{l(JSON.parse(e))}catch{l(null)}else l(null)},[]),(0,n.useEffect)(()=>{if(a){if(!s)return void e.push("/");if(!i)return void e.push("/mood")}},[s,i,e,a]);let d=(0,n.useCallback)(t=>{sessionStorage.setItem("matchData",JSON.stringify(t)),e.push(`/chat/${t.roomId}`)},[e]);return a&&s&&i?(0,t.jsx)("div",{className:"h-full overflow-auto",children:(0,t.jsx)("div",{className:"min-h-screen flex flex-col p-4 sm:p-6 lg:p-8 gradient-bg",children:(0,t.jsx)("main",{className:"grow flex items-center justify-center",children:(0,t.jsx)(o,{sessionId:s,mood:i.mood,age:i.age,country:i.country,onMatchFound:d})})})}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center gradient-bg",children:(0,t.jsx)("div",{className:"text-white text-lg",children:"Loading..."})})}function i(){return(0,t.jsx)(n.Suspense,{fallback:(0,t.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:(0,t.jsx)(c,{})})}e.s(["default",()=>i],65698)}]);